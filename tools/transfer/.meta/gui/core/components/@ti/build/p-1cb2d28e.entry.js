import{r as t,c as e,h as i,g as o}from"./p-ce1dc307.js";import{GcUtils as r}from"../gc-core-assets/lib/GcUtils";import{DataConverter as n,valueChangedEventType as s,bindingRegistry as l,ProgressCounter as a}from"../gc-core-databind/lib/CoreDatabind";import{codecRegistry as h}from"../gc-target-configuration/lib/TargetConfiguration";import{W as c}from"./p-7d517b0b.js";import{GcPromise as d}from"../gc-core-assets/lib/GcPromise";import{GcMessageDialog as g}from"../gc-widget-message-dialog/lib/GcMessageDialog";import"./p-6a8f5ea3.js";import"../gc-core-assets/lib/GcFiles";import"../gc-core-assets/lib/GcConsole";import"../gc-core-assets/lib/GcLocalStorage";const u=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}.container,.info-container:not([hidden]){display:flex;flex-direction:column;width:100%}.container{height:100%;box-sizing:border-box}.heading{font-size:var(--gc-header-font-size, var(--theme-header-font-size, 21px));font-weight:var(--gc-header-font-weight, var(--theme-header-font-weight, 500));position:relative}.heading:before{content:"";position:absolute;width:calc(100% - 10px);height:1px;bottom:2px;border-bottom:2px solid var(--theme-primary-color, #cc0000)}.sub-heading{font-size:var(--gc-sub-header-font-size, var(--theme-sub-header-font-size, 14px))}.info-title,.sub-heading{color:var(--theme-secondary-color, #118899);font-weight:bold}.info-container>div.info-title{margin-bottom:4px;margin-top:10px}.info-container,.info-container gc-widget-label{user-select:text}.heading,.sub-heading,.scroll-container{padding:5px;}.scroll-container{overflow:auto}.field-container *,.info-container *{margin:0px}.field-container{align-items:center;padding-top:5px}.field-container:not(:nth-last-child(2)){border-bottom:1px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5));padding-bottom:5px}.header-container,.widget-container{display:flex;flex-direction:row;align-items:center}.header-container>*:not(:last-child),.widget-container>*:not(:last-child){margin-right:5px}.header-container{margin-bottom:4px}.header-container gc-widget-icon{--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b));cursor:pointer}.header-container div.caption{color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400))}.widget-container{min-height:34px;}.widget-container gc-widget-led:focus{outline:1px dotted var(--gc-focus-color, var(--gc-font-color, var(--theme-font-color, #555555)));outline-offset:-1px}.flex{flex-grow:1;flex-shrink:1}.right-align{--gc-text-align:right}';let v=class{constructor(i){t(this,i);this.valueChanged=e(this,"value-changed",7);this.selectedFieldIndexChanged=e(this,"selected-field-index-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.keyCounters=new Map;this.isRendering=false;this.onRegisterValueChangedListener=()=>{var t,e;this.value=(e=(t=this.registerValueBind)===null||t===void 0?void 0:t.getValue())!==null&&e!==void 0?e:this.registerInfo.default};this.onRegisterSymbolsChangedListener=()=>{var t;this.registerInfo=(t=this.registerModel)===null||t===void 0?void 0:t.getRegisterInfo(this.registerName);this.selectedFieldIndex=-1};this.onIndicatorToggle=t=>{var e,i;const o=+t.currentTarget.id;const r=(i=(e=this.registerInfo)===null||e===void 0?void 0:e.fields)===null||i===void 0?void 0:i[o];if(r&&!this.isReadOnly(r)){this.setBitFieldValue(r,this.getBitFieldValue(r)?0:1)}};this.onIndicatorKeyHandler=t=>{if(t.key===" "&&!t.shiftKey&&!t.ctrlKey){this.onIndicatorToggle(t);t.preventDefault();t.stopPropagation()}};this.toggleHelp=t=>{if(this.selectedFieldIndex<0){this.selectedFieldIndex=+t.currentTarget.id}else{this.selectedFieldIndex=-1}};this.onWidgetValueChanged=t=>{var e,i;const o=+t.currentTarget.id;const r=(i=(e=this.registerInfo)===null||e===void 0?void 0:e.fields)===null||i===void 0?void 0:i[o];if(r){this.setBitFieldValue(r,+t.detail.value)}};this.selectedFieldIndex=-1;this.value=0;this._refresh=0;this.hidden=false}getBitFieldType(t){var e,i,o,r,n;if(((e=t.attrs)===null||e===void 0?void 0:e.isLocked)||((o=(i=this.registerInfo)===null||i===void 0?void 0:i.attrs)===null||o===void 0?void 0:o.readonly)){return"R"}if((n=(r=this.registerInfo)===null||r===void 0?void 0:r.attrs)===null||n===void 0?void 0:n.writeonly){return"W"}return"RW"}isReadOnly(t){return this.getBitFieldType(t)==="R"}getBitFieldRange(t,e=":"){if(t===undefined){return""}if(t.stop>t.start){return`${t.stop}${e}${t.start}`}if(t.stop===t.start){return`${t.stop}`}return""}getSelectValues(t){if(t.options){return`${t.options.map((t=>t.value)).join("|")}|`}const e=t.stop-t.start+1;const i=1<<e;return`${new Array(i).fill("").map(((t,e)=>`${e}`)).join("|")}|`}getSelectLabels(t){if(t.options){return`${t.options.map((t=>t.display)).join("|")}|`}const e=t.stop-t.start+1;const i=1<<e;return`${new Array(i).fill("").map(((t,i)=>`b${n.convert(i,"number","binary",e)}`)).join("|")}|`}isDecimalFormat(t){return t.widget&&(t.widget.format==="dec"||t.widget.format==="exp"||!t.widget.format&&t.widget.type==="spinner")}getBitFieldValue(t){if(this.isDecimalFormat(t)){return this.registerModel.getBinding(`${this.registerName}.${this.getSymbolName(t)}`).getValue()}const e=r.bitField.getMask(t.start,t.stop);return r.bitField.readField(this.value,e,t.start)}setBitFieldValue(t,e){if(this.isRendering){return}if(this.isDecimalFormat(t)){this.registerModel.getBinding(`${this.registerName}.${this.getSymbolName(t)}`).setValue(e)}else{const i=r.bitField.getMask(t.start,t.stop);this.value=r.bitField.writeField(this.value,i,t.start,e)}}getFormat(t){var e,i,o;return(i=(e=t.widget)===null||e===void 0?void 0:e.format)!==null&&i!==void 0?i:((o=t.widget)===null||o===void 0?void 0:o.type)==="spinner"?"dec":"hex"}getPrecision(t){var e,i,o,r;if(((e=t.widget)===null||e===void 0?void 0:e.type)==="spinner"&&!t.widget.format){let e=0;const r=(o=(i=t.widget.step)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:"";if(r.includes(".")){e=r.length-r.indexOf(".")-1}return e}return((r=t.widget)===null||r===void 0?void 0:r.format)?t.widget.precision:Math.ceil((t.stop-t.start+1)/4)}getReadOnlyDisplayValue(t,e){var i;if(t.options&&t.options.length>e){return t.options[e].display}const o=t.stop-t.start+1;let r;let s;if((i=t.widget)===null||i===void 0?void 0:i.format){r=t.widget.format;s=t.widget.precision}else{r=o<8?"binary":"hex";s=o<8?o:Math.ceil(o/4)}const l=n.convert(e,"number",r,s);return r==="binary"?"b"+l:l}getSymbolName(t){return t.id||t.name}getRegisterDisplayName(){return this.registerInfo?`${this.registerInfo.groupName?`${this.registerInfo.groupName} / `:""}${this.registerInfo.name}`:""}getBifFieldWidgetType(t){var e,i;const o=this.isReadOnly(t);const r=((e=t.widget)===null||e===void 0?void 0:e.type)!==undefined&&t.widget.type!=="value";if(o&&!r){return"label"}if((i=t.widget)===null||i===void 0?void 0:i.type){return t.widget.type}if(t.options){return"select"}if(t.stop===t.start){return"checkbox"}if(t.stop<=t.start+3){return"select"}return"value"}generateKey(t){let e=this.keyCounters.get(t);if(e===undefined){e={count:0,total:0};this.keyCounters.set(t,e)}e.count++;if(e.count>e.total){e.total=e.count}return`${t}${e.count}`}renderBitFieldWidget(t,e,o=undefined,r){var n,s,l,a,h,c;const d=r?this.getBitFieldValue(r):0;const g=((n=r===null||r===void 0?void 0:r.widget)===null||n===void 0?void 0:n.units)?"flex right-align":"flex";switch(t){case"label":return i("gc-widget-label",{id:o,label:r?this.getReadOnlyDisplayValue(r,d):undefined});case"checkbox":return i("gc-widget-checkbox",{id:o,readonly:e,checked:d!==0,"onChecked-changed":this.onWidgetValueChanged});case"select":return i("gc-widget-select",{id:o,class:g,readonly:e,"selected-value":d,values:r?this.getSelectValues(r):"0",labels:r?this.getSelectLabels(r):"_","onSelected-value-changed":this.onWidgetValueChanged});case"spinner":return i("gc-widget-spinner",{id:o,class:"flex right-align",readonly:e,value:d,"min-value":(s=r===null||r===void 0?void 0:r.widget)===null||s===void 0?void 0:s.min,"max-value":(l=r===null||r===void 0?void 0:r.widget)===null||l===void 0?void 0:l.max,increment:(a=r===null||r===void 0?void 0:r.widget)===null||a===void 0?void 0:a.step,format:r?this.getFormat(r):"dec",precision:r?this.getPrecision(r):undefined,"onValue-changed":this.onWidgetValueChanged});case"indicator":return i("gc-widget-led",{id:o,on:d!==0,onClick:this.onIndicatorToggle,tabIndex:0,style:{"--gc-on-color":(h=r===null||r===void 0?void 0:r.widget)===null||h===void 0?void 0:h.onColor,"--gc-off-color":(c=r===null||r===void 0?void 0:r.widget)===null||c===void 0?void 0:c.offColor},onKeyDown:this.onIndicatorKeyHandler});default:return i("gc-widget-input",{id:o,class:g,readonly:e,value:d,format:r?this.getFormat(r):"hex",precision:r?this.getPrecision(r):4,"onValue-changed":this.onWidgetValueChanged})}}renderBitField(t,e=-1,o){var r,n;const s=o?this.isReadOnly(o):false;const l=e<0?undefined:`${e}`;const a=e<0?false:e===this.selectedFieldIndex;const h=e<0||!a&&this.selectedFieldIndex>=0;const c=this.generateKey(t);return i("div",{class:"field-container",key:c,id:c,hidden:h},i("div",{class:"header-container"},i("div",{class:"caption"},`${(r=o===null||o===void 0?void 0:o.name)!==null&&r!==void 0?r:""}[${this.getBitFieldRange(o)}]`),i("gc-widget-icon",{id:l,appearance:a?"primary":"custom",icon:a?"navigation:cancel":"action:help_outline",size:a?"s":"xs",onClick:this.toggleHelp})),i("div",{class:"widget-container"},i("gc-widget-icon",{hidden:!s,size:"xs",appearance:"tertiary",icon:"action:lock"}),this.renderBitFieldWidget(t,s,l,o),((n=o===null||o===void 0?void 0:o.widget)===null||n===void 0?void 0:n.units)?i("gc-widget-label",{label:o.widget.units}):null))}render(){var t,e,o,r,n,s;const l=(e=(t=this.registerInfo)===null||t===void 0?void 0:t.fields[this.selectedFieldIndex])!==null&&e!==void 0?e:{name:"",start:0,stop:0};const a=this.selectedFieldIndex<0;this.keyCounters.forEach((t=>t.count=0));const h=(n=(r=(o=this.registerInfo)===null||o===void 0?void 0:o.fields)===null||r===void 0?void 0:r.map(((t,e)=>{var i;return((i=t.attrs)===null||i===void 0?void 0:i.isHidden)?null:this.renderBitField(this.getBifFieldWidgetType(t),e,t)})))!==null&&n!==void 0?n:[];const c=[];this.keyCounters.forEach(((t,e)=>{while(t.count<t.total){c.push(this.renderBitField(e))}}));return i("div",{class:"container"},this.heading?i("div",{key:"heading",class:"heading"},this.heading):null,i("div",{key:"sub-heading",class:"sub-heading"},this.getRegisterDisplayName()),i("div",{key:"scroll-container",class:"scroll-container"},c,h,a?null:i("div",{key:"forceDividerLine"}),i("div",{class:"info-container",key:"information",hidden:a},i("div",{class:"info-title"},"Field"),i("gc-widget-label",{label:l.title||l.name}),i("div",{class:"info-title"},"Bit"),i("gc-widget-label",{label:this.getBitFieldRange(l," - ")}),i("div",{class:"info-title"},"Type"),i("gc-widget-label",{label:this.getBitFieldType(l)}),i("div",{class:"info-title"},"Description"),i("div",{innerHTML:(s=l.desc)===null||s===void 0?void 0:s.split("\n").join("<br>")}))))}addRegisterBindListener(){if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").addEventListener(s,this.onRegisterSymbolsChangedListener);if(this.registerInfo){this.registerValueBind=this.registerModel.getBinding(this.getSymbolName(this.registerInfo));this.registerValueBind.addEventListener(s,this.onRegisterValueChangedListener)}}}removeRegisterBindListener(){if(this.registerValueBind){this.registerValueBind.removeEventListener(s,this.onRegisterValueChangedListener);this.registerValueBind=undefined}if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").removeEventListener(s,this.onRegisterSymbolsChangedListener)}}connectedCallback(){this.onRegisterInfoChanged()}disconnectedCallBack(){this.removeRegisterBindListener()}componentWillRender(){this.isRendering=true}componentDidRender(){this.isRendering=false}onValueChanged(){var t;(t=this.registerValueBind)===null||t===void 0?void 0:t.setValue(this.value);this.valueChanged.emit({value:this.value})}onRegisterInfoChanged(){this.removeRegisterBindListener();let t;if(this.registerModelId){t=l.getModel(this.registerModelId);if(!t&&this.registerModelId){h.whenConfigurationReady(this.registerModelId).then((()=>this.onRegisterInfoChanged()))}}this.registerModel=(t===null||t===void 0?void 0:t.getConvertedValue)?t:undefined;this.onRegisterSymbolsChangedListener();this.addRegisterBindListener();if(this.registerInfo){this.onRegisterValueChangedListener()}}onSelectedFieldChanged(){this.selectedFieldIndexChanged.emit({value:this.selectedFieldIndex})}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return o(this)}static get watchers(){return{value:["onValueChanged"],registerModelId:["onRegisterInfoChanged"],registerName:["onRegisterInfoChanged"],selectedFieldIndex:["onSelectedFieldChanged"]}}};v.style=u;const f=":host{background-color:var(--gc-heading-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)));font-weight:var(--gc-font-weight, 500);font-size:var(--gc-font-size, var(--gc-font-size, var(--theme-font-size, 14px)));font-style:var(--gc-font-style, normal);white-space:nowrap;margin:0px;position:sticky;top:0%;text-align:var(--gc-heading-text-align, center);width:100%;align-self:stretch;box-sizing:border-box}:host(:focus),:host *:focus{outline:none}.header-container{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)))}.header-container>*:not(.stretch){flex-shrink:0}.stretch{flex:1}label,gc-widget-label{overflow:hidden;text-overflow:ellipsis;padding:5px 5px 5px 5px}slot::slotted(*:focus),.action:focus{outline:1px dotted var(--gc-focus-color, var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555))));outline-offset:1px}.action{--gc-color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));cursor:pointer}";const p=32;const m=22;function b(t,e){return{display:e?"none":"grid","grid-template-columns":t>p?"min-content":`repeat(${t}, ${m}px)`}}class x{constructor(t,e){this.params=t;this.parentTree=e;this.onToggleBitClickHandler=t=>{this.doToggleBit(t.currentTarget)};this.bitSelectClickHandler=t=>{const e=t.target;const i=e.id.split(":");if(i.length>1){this.params.selectedBit=+i[1];this.setFocusOnBit(t.currentTarget,this.params.selectedBit)}};this.onFocusHandler=t=>{const e=t.currentTarget;this.setFocusOnBit(e,this.params.selectedBit)};this.onBlurHandler=t=>{this.setFocusOnBit(t.currentTarget,-1)};this.onKeyboardHandler=t=>{var e,i;let o=this.params.selectedBit;const r=t.currentTarget;switch(t.key){case"1":case"0":case"Enter":case" ":if(((i=(e=this.getCell(r,o))===null||e===void 0?void 0:e.innerHTML)!==null&&i!==void 0?i:t.key)!==t.key){this.doToggleBit(this.getCell(r,o))}t.stopPropagation();t.preventDefault();break;case"F2":o-=1;case"ArrowLeft":o+=2;case"ArrowRight":o-=1;if(o>=0&&o<(this.params.dataBits||1)){this.params.selectedBit=o;this.setFocusOnBit(r,o);t.stopPropagation();t.preventDefault()}break;case"Escape":this.setFocusOnBit(r,-1);t.stopPropagation();t.preventDefault();break}};this.align="center";this.hideFocusRectangle=true}getCell(t,e){if(e<0){return undefined}return t.querySelector(`span:nth-last-child(${e+1})`)}doToggleBit(t){var e;const i=(e=t===null||t===void 0?void 0:t.id.split(":"))!==null&&e!==void 0?e:[];if(i.length===2){const t=+i[0];const e=+i[1];const o=this.parentTree.getCommittedEditValue(t,this.params.name);const n=r.bitField.getMask(e,e);const s=r.bitField.writeField(o,n,e,r.bitField.readField(o,n,e)^1);this.parentTree.commitEditValueChange(+i[0],this.params.name,s)}}setFocusOnBit(t,e){const i=this.getCell(t,e);if(this.focusedElement&&this.focusedElement!==i){this.focusedElement.classList.remove("focused");this.focusedElement=undefined}this.focusedElement=i;if(this.focusedElement&&!this.focusedElement.classList.contains("focused")){this.focusedElement.classList.add("focused");this.parentTree.scrollIntoViewHorizontally(this.focusedElement)}}renderCell(t,e,o,n,s){const l=this.params.dataBits||1;const a=e.getValue("value");const h=a!==undefined?e.getValue("committedValue"):0;let c=l>p?1:r.bitField.getMask(l-1,l-1);const d=this.params.minimized||this.params.hidden;const g=l<=p?new Array(l).fill(null).map(((n,s)=>{var d,g,u;const v=l-s-1;let f;let p;let m;if(a!==undefined){const t=(((d=e.getValue("reservedMask"))!==null&&d!==void 0?d:0)&c)!==0;m=t||(((g=e.getValue("readonlyMask"))!==null&&g!==void 0?g:0)&c)!==0;const i=(((u=e.getValue("visibleMask"))!==null&&u!==void 0?u:-1)&c)===0;const n=o?((this.params.selectedBitsMask||0)&c)!==0:false;p=t?"-":i?"":r.bitField.readField(a,c)?"1":"0";const s=t||i||m?false:p!==(r.bitField.readField(h,c)?"1":"0");f=`bit-cell${m?" readonly":""}${i?" empty":""}${n?" selected":""}${s?" deferred":""}`}else{p="";f="bit-cell empty";m=true}c=c>>>1;return i("span",{id:`${t}:${v}${m?":R":""}`,part:f,onDblClick:this.onToggleBitClickHandler},p)})):[i("span",null)];const u=i("div",{part:"bits-container",tabIndex:s,style:b(l,d),onMouseDown:this.bitSelectClickHandler,onKeyDown:this.onKeyboardHandler,onFocus:this.onFocusHandler,onBlur:this.onBlurHandler},g);return{element:u,focusable:!d}}restoreEditorSelectionState(t,e){switch(e.hint){case"ArrowRight":case"Home":this.params.selectedBit=(this.params.dataBits||1)-1;break;case"ArrowLeft":case"End":this.params.selectedBit=0;break}this.setFocusOnBit(t,this.params.selectedBit)}}let w=class{constructor(i){t(this,i);this.selectedBitChanged=e(this,"selected-bit-changed",7);this.minimizedChanged=e(this,"minimized-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.base=new class extends c{get element(){return this.parent.el}}(this);this.selectedBit=-1;this.onFocusHandler=()=>{var t;(t=this.base.parentGrid)===null||t===void 0?void 0:t.setFocus()};this.hideMinimizeAction=false;this.minimized=false;this._refresh=0;this.hidden=false}onSelectedBitChanged(){this.selectedBitChanged.emit({value:this.selectedBit})}render(){const t=this.dataBits||1;const e=t<=p?new Array(t).fill(null).map(((e,o)=>i("span",{part:`bit-cell${o===0?" first-child":""}`},t-o-1))):[i("span",{part:"bit-cell"},`Greater than ${p} bit wide registers are not supported`)];return i("div",{style:{display:"flex","flex-direction":"column"},tabIndex:-1,onFocus:this.onFocusHandler},this.base.renderHeader(),this.hidden||this.minimized?i("div",{part:"bits-header-padding"},"1"):null,i("div",{part:"bits-container",style:b(t,this.hidden||this.minimized)},e))}async createCellRenderer(t){this.base.parentGrid=t;return new x(this,t)}onColumnPropertyChanged(){var t;(t=this.base.parentGrid)===null||t===void 0?void 0:t.redraw()}onMinimizedChanged(){this.minimizedChanged.emit({value:this.minimized})}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return o(this)}static get watchers(){return{selectedBit:["onSelectedBitChanged"],dataBits:["onColumnPropertyChanged"],selectedBitsMask:["onColumnPropertyChanged"],hidden:["onColumnPropertyChanged"],hideMinimizeAction:["onColumnPropertyChanged"],minimized:["onColumnPropertyChanged","onMinimizedChanged"]}}};w.style=f;const k=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}gc-widget-grid-tree-column{--gc-column-width:minmax(220px, 1fr)}gc-widget-grid-data-column{--gc-text-align:center}:host{border:2px solid var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)))}#grid{width:100%;height:100%;margin:0px;border:none}#grid::part(open){font-style:italic}#grid::part(branch){font-weight:500;font-size:93%}#grid::part(leaf){font-size:86%}#bitsHeader::part(bit-cell){border:1px solid var(--gc-background-color, var(--gc-background-color, var(--theme-background-color, #ffffff)));border-bottom-width:0px;border-right-width:0px;font-weight:400}#bitsHeader::part(bit-cell first-child){border-left-color:transparent}#bitsHeader::part(bit-cell),#grid::part(bit-cell){width:100%;display:inline-flex;align-items:center;justify-content:center}#grid::part(bit-cell readonly){background-color:var(--gc-background-color-disabled, var(--theme-background-color-disabled, #e5e5e5));color:var(--gc-font-color-disabled, var(--theme-font-color-disabled, #999999))}#grid::part(bit-cell selected){background-color:var(--gc-register-field-background-color-selected, #ffffb3)}#grid::part(deferred){text-decoration:underline;font-style:italic}#grid::part(bits-container),#bitsHeader::part(bits-container){grid-gap:0;grid-template-rows:1fr;justify-items:center;height:100%}#grid::part(bits-container){padding-right:1px;padding-left:2px}#bitsHeader::part(bits-header-padding){overflow:hidden;width:0px;display:none;}#grid::part(focused){outline:1px dotted var(--gc-outline-color-focus, var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555))));outline-offset:-3px}';class y{constructor(t,e){var i,o,n;this.reservedMask=0;this.isVisibleInGrid=false;this.name=t.id||t.name;this.address=t.addr;this.binding=e.getBinding(this.name);this.readonly=(o=(i=t.attrs)===null||i===void 0?void 0:i.readonly)!==null&&o!==void 0?o:false;this.path=`${t.groupName}/${this.name}`;this.visibleMask=r.bitField.getMask(0,(t.size||t.nBytes*8||8)-1);this.readonlyMask=this.readonly?this.visibleMask:0;(n=t.fields)===null||n===void 0?void 0:n.forEach((t=>{if(t.attrs){const e=r.bitField.getMask(t.start,t.stop);if(t.attrs.isHidden){this.visibleMask=r.bitField.writeField(this.visibleMask,e,t.start,0)}if(t.attrs.isLocked){this.readonlyMask=r.bitField.writeField(this.readonlyMask,e,t.start,-1)}if(t.attrs.isReserved){this.reservedMask=r.bitField.writeField(this.reservedMask,e,t.start,-1)}}}))}get value(){return this.binding.getValue()}set value(t){if(!this.readonly){this.binding.setValue(t)}}get status(){return this.binding.status}get committedValue(){return this.binding.getValueCommitted()}get isDeferredWritePending(){return this.binding.isDeferredWritePending()}}class C{constructor(t,e){this.name=t.name;this.registers=t.registers.filter((t=>{var e;return!((e=t.attrs)===null||e===void 0?void 0:e.isHidden)})).map((t=>new y(t,e)))}addChangeListeners(t){this.registers.forEach((e=>e.binding.addEventListener(s,t)))}removeChangeListeners(t){this.registers.forEach((e=>e.binding.removeEventListener(s,t)))}get rowCount(){return this.registers.length}getValue(t,e){return this.registers[t][e]}setValue(t,e,i){this.registers[t][e]=i}isReadonly(t){return this.registers[t].readonly}lookupRowByName(t){return this.registers.findIndex((e=>e.name===t))}lookupRegisterByName(t){return this.registers[this.lookupRowByName(t)]}getPartName(t,e){return e==="value"&&this.registers[t].isDeferredWritePending?"deferred":""}}class z extends C{updateChangedEventListener(t){if(this.onChangedEventListener){if(t.isVisibleInGrid){t.binding.addEventListener(s,this.onChangedEventListener)}else{t.binding.removeEventListener(s,this.onChangedEventListener)}}}setVisibility(t,e){const i=this.registers[t];if(!i){return}if(i.isVisibleInGrid===e){return}i.isVisibleInGrid=e;this.updateChangedEventListener(i)}addChangeListeners(t){this.onChangedEventListener=t;this.registers.forEach((t=>this.updateChangedEventListener(t)))}removeChangeListeners(t){this.onChangedEventListener=undefined;super.removeChangeListeners(t)}}class ${constructor(t,e){var i,o;const r=(i=t===null||t===void 0?void 0:t.getBinding("$registerDefinitions"))===null||i===void 0?void 0:i.getValue();this.dataBits=(r===null||r===void 0?void 0:r.info.regsize)||16;const n=(r===null||r===void 0?void 0:r.regblocks.reduce(((t,e)=>e.registers.reduce(((t,e)=>Math.max(t,e.addr)),t)),0))||255;this.addressSize=n.toString(16).length;this.groups=(o=r===null||r===void 0?void 0:r.regblocks.filter((t=>{var e;return!((e=t.attrs)===null||e===void 0?void 0:e.isHidden)})).map((i=>{if(e){return new z(i,t)}return new C(i,t)})))!==null&&o!==void 0?o:[]}isExpandable(t){return true}getChildDataProvider(t){return this.groups[t]}get rowCount(){return this.groups.length}getValue(t,e){return this.groups[t][e]}setValue(){}lookupRowByName(t){return this.groups.findIndex((e=>e.name===t))}addChangeListeners(t){this.groups.forEach((e=>e.addChangeListeners(t)))}removeChangeListeners(t){this.groups.forEach((e=>e.removeChangeListeners(t)))}lookupRegisterByName(t){if(!t){return}return this.groups.reduce(((e,i)=>e!==null&&e!==void 0?e:i.lookupRegisterByName(t)),undefined)}}let S=class{constructor(i){t(this,i);this.selectedRegisterChanged=e(this,"selected-register-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.fontSize=S.REFERENCE_FONT_SIZE;this.registerModelIdMap=new Map;this.selectedRegisterPath="";this.virtual=false;this.selectedRegister="";this.sortDescending=false;this.hideAddressColumn=false;this.hideBitsColumn=false;this.onSelectedPathChanged=()=>{var t,e;this.selectedRegisterPath=(e=(t=this.grid)===null||t===void 0?void 0:t.selectedPath)!==null&&e!==void 0?e:"";const i=this.selectedRegisterPath.split("/");if(i.length>1){this.selectedRegister=i[1]}else{this.selectedRegister=""}};this.onRegisterValueChangedListener=()=>{var t;(t=this.grid)===null||t===void 0?void 0:t.refresh()};this.onRegisterSymbolsChangedListener=()=>{var t,e;(t=this.dataProvider)===null||t===void 0?void 0:t.removeChangeListeners(this.onRegisterValueChangedListener);this.dataProvider=new $(this.registerModel,this.virtual);(e=this.grid)===null||e===void 0?void 0:e.setDataProvider(this.dataProvider,this.getExpandToLevel(),this.registerModel?this.registerModelId:undefined);this.dataProvider.addChangeListeners(this.onRegisterValueChangedListener)};this._refresh=0;this.hidden=false}onVirtualChanged(){this.onRegisterSymbolsChangedListener()}getExpandToLevel(){if(this.registerModel){if(this.registerModelIdMap.has(this.registerModelId)){return 0}this.registerModelIdMap.set(this.registerModelId,true)}return 2}async addRegisterDefinitionsListener(){if(this.registerModelId){this.registerModel=l.getModel(this.registerModelId);if(!this.registerModel){const t=this.registerModelId;await h.whenConfigurationReady(this.registerModelId);if(this.registerModelId!==t){return}this.registerModel=l.getModel(this.registerModelId)}}this.onRegisterSymbolsChangedListener();if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").addEventListener(s,this.onRegisterSymbolsChangedListener)}}removeRegisterDefinitionsListener(){if(this.registerModel){this.registerModel.getBinding("$registerDefinitions").removeEventListener(s,this.onRegisterSymbolsChangedListener)}this.registerModel=undefined}get addressPrecision(){var t;return this.addressBits?Math.ceil(this.addressBits/4):((t=this.dataProvider)===null||t===void 0?void 0:t.addressSize)||2}get displayBits(){var t;return this.dataBits||((t=this.dataProvider)===null||t===void 0?void 0:t.dataBits)||8}get dataPrecision(){return Math.ceil(this.displayBits/4)}componentWillRender(){const t=Number.parseFloat(getComputedStyle(this.el).getPropertyValue("font-size"));if(!isNaN(t)){this.fontSize=t}}render(){var t;const e=Math.ceil((Math.max(this.dataPrecision,8)+2)*10*this.fontSize/S.REFERENCE_FONT_SIZE);let o=0;if(this.selectedField&&this.selectedRegister){const e=(t=this.registerModel)===null||t===void 0?void 0:t.getRegisterInfo(`${this.selectedRegister}.${this.selectedField}`);if(e){o=r.bitField.getMask(e.start,e.stop)}}return i("gc-widget-grid",{id:"grid",ref:t=>this.grid=t,selectedPath:this.selectedRegisterPath,"onSelected-path-changed":this.onSelectedPathChanged,filterText:this.filterText,sortByColumn:this.sortBy,sortDescending:this.sortDescending,virtual:this.virtual},i("gc-widget-grid-tree-column",{heading:"Register Name",hideMinimizeAction:true,showInfoIcon:true},i("slot",null)),this.hideAddressColumn?null:i("gc-widget-grid-data-column",{key:"address",heading:"Address",name:"address",readonly:true,format:"hex",precision:this.addressPrecision}),i("gc-widget-grid-data-column",{key:"value",heading:"Value",name:"value",format:"hex",precision:this.dataPrecision,style:{"--gc-column-width":`${e}px`}}),this.hideBitsColumn?null:i("gc-widget-register-bits-column",{id:"bitsHeader",heading:"Bits",name:"value",dataBits:this.displayBits,selectedBitsMask:o}))}onRegisterModelIdChanged(){this.removeRegisterDefinitionsListener();this.addRegisterDefinitionsListener()}onSelectedRegisterChanged(){var t,e;let i;if(this.selectedRegister){i=(t=this.dataProvider)===null||t===void 0?void 0:t.lookupRegisterByName(this.selectedRegister);this.selectedRegisterPath=(e=i===null||i===void 0?void 0:i.path)!==null&&e!==void 0?e:""}else if(this.selectedRegisterPath.split("/").length>1){this.selectedRegisterPath=""}this.selectedRegisterChanged.emit({value:this.selectedRegister})}async lookupFieldByBit(t){var e,i;const o=(e=this.registerModel)===null||e===void 0?void 0:e.getRegisterInfo(this.selectedRegister);const r=(i=o===null||o===void 0?void 0:o.fields)===null||i===void 0?void 0:i.find((e=>e.start>=t&&e.stop<=t));return(r===null||r===void 0?void 0:r.id)||(r===null||r===void 0?void 0:r.name)}async setFilterMethod(t){var e;(e=this.grid)===null||e===void 0?void 0:e.setFilterMethod(t)}async redrawGrid(){var t;(t=this.grid)===null||t===void 0?void 0:t.refresh()}expandToLevel(t){if(!this.grid){throw new Error("Register grid not rendered yet.  You cannot expand levels until the grid has rendered at least once.")}return this.grid.expandToLevel(t)}connectedCallback(){this.addRegisterDefinitionsListener()}disconnectedCallBack(){this.removeRegisterDefinitionsListener()}componentDidLoad(){var t;if(this.dataProvider){(t=this.grid)===null||t===void 0?void 0:t.setDataProvider(this.dataProvider,2,this.registerModel?this.registerModelId:undefined)}}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return o(this)}static get watchers(){return{virtual:["onVirtualChanged"],registerModelId:["onRegisterModelIdChanged"],selectedRegister:["onSelectedRegisterChanged"]}}};S.REFERENCE_FONT_SIZE=14;S.style=k;const R=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}.root-container{height:100%;width:100%;position:relative;overflow:hidden}.root-container *{margin:0px}.row{display:flex;flex-direction:row;justify-content:flex-start;align-items:flex-start}.row>*{margin:5px}.row.center{align-items:center}.row.bottom{align-items:flex-end}.row.justify-end{justify-content:flex-end}.row.wrap{flex-wrap:wrap}.column{display:flex;flex-direction:column}div{position:relative}.stretch{flex:1;flex-basis:0.0000001px}#bitFieldViewer{width:334px;height:100%;margin:0px;padding:5px 0 0 10px;box-sizing:border-box}gc-widget-select{min-width:95px}.title{position:relative;padding:5px;margin-top:15px;margin-bottom:15px;width:min-content;white-space:nowrap}.title:before{content:"";position:absolute;width:40%;height:1px;bottom:2px;border-bottom:2px solid var(--theme-primary-color, #cc0000)}.title .heading{font-size:var(--gc-header-font-size, var(--theme-header-font-size, 21px));font-weight:var(--gc-header-font-weight, var(--theme-header-font-weight, 500))}.title .sub-heading{font-size:var(--gc-sub-header-font-size, var(--theme-sub-header-font-size, 14px));padding-left:10px}#search{margin:0px 5px 4px 0px}.fill{width:100%;height:100%;margin:0px;box-sizing:border-box}#main{overflow-x:auto;overflow-y:hidden}#main *.stretch{min-width:0px}.no-shrink{flex-shrink:0}#registerDetails{overflow-x:hidden;overflow-y:auto}#registerDetails table{border-collapse:collapse;width:100%;box-sizing:border-box;user-select:text}#registerDetails>div{margin:10px 5px 5px 5px}#registerDetails>.detail-heading{font-size:125%;font-weight:bold;display:inline}#registerDetails th{background-color:var(--gc-heading-color, var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5))));color:var(--gc-heading-font-color);vertical-align:middle;text-align:center}#registerDetails th,#registerDetails td{border:2px solid var(--gc-border-color, var(--gc-border-color, var(--theme-border-color, #e5e5e5)))}#registerDetails td{padding:10px;vertical-align:top;text-align:left;white-space:nowrap}#registerDetails td.col3{white-space:normal;overflow-wrap:break-word}.clickable{margin:5px;cursor:pointer}#deferredModeSwitch{min-height:30px;}';let D=class{constructor(i){t(this,i);this.autoReadValueChanged=e(this,"auto-read-value-changed",7);this.cssPropertyChanged=e(this,"css-property-changed",7);this.modelReadyPromises=new Map;this.modelsDeferred=new Map;this.searchBitFields=false;this.modelIdLabels="";this.selectedFieldIndex=-1;this.activeDeviceName="";this.deferredWriteEnabled=false;this.autoReadValue=100;this.filterText="";this.virtual=false;this.hideDeviceName=false;this.onSelectedRegisterChanged=t=>{this.selectedRegister=t.detail.value};this.onSelectedFieldIndexChanged=t=>{this.selectedFieldIndex=t.detail.value};this.onSearchBitFieldsCheckedChanged=t=>{this.searchBitFields=t.detail.value;this.setFilterMethod()};this.onSelectedModelChanged=t=>{this.setActiveModel(t.detail.value)};this.onModelRefreshRateValueChanged=t=>{this.autoReadValue=t.newValue};this.onRegisterDefinitionsChanged=t=>{this.activeDeviceRegisterInfo=t.newValue};this.onAutoReadSelectedValueChanged=t=>{var e;const i=(e=this.activeRegisterModel)===null||e===void 0?void 0:e.getBinding("$refresh_interval");i===null||i===void 0?void 0:i.setValue(t.detail.value)};this.onFilterTextChanged=t=>{this.filterText=t.detail.value};this.doRead=()=>{var t,e;if(!((t=this.activeRegisterModel)===null||t===void 0?void 0:t.isConnected())){g.error("Must be connected to target to read registers.");return}const i=(e=this.activeRegisterModel)===null||e===void 0?void 0:e.getBinding(this.selectedRegister);if(i===null||i===void 0?void 0:i.refresh){this.startProgress("Read");i.refresh(this.busyProgress);this.busyProgress.done()}};this.doReadAll=()=>{var t,e;if(!((t=this.activeRegisterModel)===null||t===void 0?void 0:t.isConnected())){g.error("Must be connected to target to read registers.");return}if((e=this.activeRegisterModel)===null||e===void 0?void 0:e.refreshAllBindings){this.startProgress("Read");this.activeRegisterModel.refreshAllBindings(this.busyProgress);this.busyProgress.done()}};this.doWrite=()=>{var t,e;const i=(t=this.activeRegisterModel)===null||t===void 0?void 0:t.getBinding(this.selectedRegister);if(i){if(this.activeRegisterModel.isConnected()){this.startProgress()}else{g.warning(`Write to ${this.selectedRegister} enqueued - not connected to target.`)}this.doWriteDeferredRegister(i,true);if(this.busyProgress){this.busyProgress.done();(e=this.grid)===null||e===void 0?void 0:e.redrawGrid()}}};this.doWriteAll=()=>{var t,e;if(((t=this.activeDeviceRegisterInfo)===null||t===void 0?void 0:t.regblocks.length)>0){if(this.activeRegisterModel.isConnected()){this.startProgress()}else{const t=this.getUncommittedWriteCount(this.activeRegisterModel);if(t>0){g.warning(`Write to ${t} register(s) enqueued - not connected to target.`)}}this.activeDeviceRegisterInfo.regblocks.forEach((t=>{t.registers.forEach((t=>{var e;this.doWriteDeferredRegister((e=this.activeRegisterModel)===null||e===void 0?void 0:e.getBinding(t.id))}))}));if(this.busyProgress){this.busyProgress.done();(e=this.grid)===null||e===void 0?void 0:e.redrawGrid()}}};this.onWriteDeferredModeChanged=async t=>{var e,i,o;const r=t.detail.value?true:false;if(r===this.deferredWriteEnabled){return}let n;if(this.activeRegisterModelId){this.modelsDeferred.set(this.activeRegisterModelId,r)}const s=r?0:this.getUncommittedWriteCount(this.activeRegisterModel);if(s>0){n=await g.prompt("Register View","Commit Pending Writes?","content:create",true,false,"no,yes")}if(n==="dismiss"){this.deferredModeToggle.checked=true;return}if(n==="yes"){if((e=this.activeRegisterModel)===null||e===void 0?void 0:e.isConnected()){this.startProgress()}else{g.warning(`Write to ${s} register(s) enqueued - not connected to target.`)}}(i=this.activeDeviceRegisterInfo)===null||i===void 0?void 0:i.regblocks.forEach((t=>{t.registers.forEach((t=>{var e;const i=(e=this.activeRegisterModel)===null||e===void 0?void 0:e.getBinding(t.id);if(n==="no"){i===null||i===void 0?void 0:i.clearDeferredWrite()}i===null||i===void 0?void 0:i.setDeferredMode(r,this.busyProgress,false)}))}));(o=this.busyProgress)===null||o===void 0?void 0:o.done();if(n==="yes"){this.grid.redrawGrid()}this.deferredWriteEnabled=r};this.toggleDetails=()=>{this.showDetails=this.showDetails?undefined:this.selectedRegister;this.setFilterMethod()};this.filterRegisterForDetailsCallback=(t,e,i)=>{var o,r;const n=""+e.getValue(t,"name");return n===i&&!((r=(o=e).isExpandable)===null||r===void 0?void 0:r.call(o,t))};this.filterRegistersOnlyCallback=(t,e,i,o)=>{var r;if(o){return false}const n=""+e.getValue(t,"name");if(e.isExpandable){return this.hasFilterRegister(n,i)}return(r=n===null||n===void 0?void 0:n.toLowerCase().includes(i))!==null&&r!==void 0?r:false};this.filterRegistersAndFieldsCallback=(t,e,i,o)=>{var r;if(this.filterRegistersOnlyCallback(t,e,i,o)){return true}if(!o&&this.activeRegisterModelId){const o=""+e.getValue(t,"name");const n=(r=this.activeRegisterModel)===null||r===void 0?void 0:r.getRegisterInfo(o);return this.hasFilteredField(n,i)}return false};this._refresh=0;this.hidden=false}async setActiveModel(t){var e,i,o;if(this.refreshIntervalBind){this.refreshIntervalBind.removeEventListener(s,this.onModelRefreshRateValueChanged);this.refreshIntervalBind=undefined}if(this.registerDefinitionsBind){this.registerDefinitionsBind.removeEventListener(s,this.onRegisterDefinitionsChanged);this.registerDefinitionsBind=undefined}this.activeRegisterModelId=t;this.activeRegisterModel=undefined;this.activeDeviceRegisterInfo=undefined;if(t){if(!this.modelReadyPromises.has(t)){this.modelReadyPromises.set(t,d.timeout(h.whenConfigurationReady(t),5e3,"Timeout on model ready"))}await this.modelReadyPromises.get(t);const r=l.getModel(t);if(r&&this.activeRegisterModelId===t){this.refreshIntervalBind=r.getBinding("$refresh_interval");if(this.refreshIntervalBind){this.refreshIntervalBind.addEventListener(s,this.onModelRefreshRateValueChanged);this.autoReadValue=+this.refreshIntervalBind.getValue()}this.activeRegisterModel=r;this.registerDefinitionsBind=this.activeRegisterModel.getBinding("$registerDefinitions");if(this.registerDefinitionsBind){(e=this.registerDefinitionsBind)===null||e===void 0?void 0:e.addEventListener(s,this.onRegisterDefinitionsChanged);this.activeDeviceRegisterInfo=(i=this.registerDefinitionsBind)===null||i===void 0?void 0:i.getValue();this.deferredWriteEnabled=(o=this.modelsDeferred.get(this.activeRegisterModelId))!==null&&o!==void 0?o:false}}}}get autoReadLabels(){return this.autoReadSelectorLabels||"Off|As fast as possible|15ms Delay|50ms Delay|100ms Delay|500ms Delay|1s Delay|5s Delay|10s Delay|60s Delay"}get autoReadValues(){return this.autoReadSelectorValues||"-1,0,15,50,100,500,1000,5000,10000,60000"}async startProgress(t="Written"){const e=this.busyProgress=new a;const{progress:i,result:o}=await g.progress("",`${t.substring(0,4)}ing registers ...`,"",true,0,100,true);const r=setInterval((()=>{const o=e.count-1;const r=e.totalCount-1;if(o<r){i.setMessage(`${o} of ${r} registers ${t.toLowerCase()}`)}else{i.setMessage(`${r} registers ${t.toLowerCase()}`)}i.setValue(e.getProgress())}),100);await o;clearInterval(r);this.busyProgress=undefined}doWriteDeferredRegister(t,e=false){if(e||(t===null||t===void 0?void 0:t.isDeferredWritePending())){t.setDeferredMode(false,this.busyProgress,e);t.setDeferredMode(true)}}getUncommittedWriteCount(t){var e;return(e=this.activeDeviceRegisterInfo)===null||e===void 0?void 0:e.regblocks.reduce(((e,i)=>e+i.registers.reduce(((e,i)=>{var o;return e+(((o=t.getBinding(i.id))===null||o===void 0?void 0:o.isDeferredWritePending())?1:0)}),0)),0)}hasFilteredField(t,e){var i,o,r,n;const s=(i=t===null||t===void 0?void 0:t.fields)!==null&&i!==void 0?i:[];for(let t=0;t<s.length;t++){if(((o=s[t].name)===null||o===void 0?void 0:o.toLowerCase().includes(e))&&!(((r=s[t].attrs)===null||r===void 0?void 0:r.isHidden)||s[t].name.toLowerCase()==="reserved"&&((n=s[t].attrs)===null||n===void 0?void 0:n.isReserved))){return true}}return false}hasFilterRegister(t,e){var i;const o=(i=this.activeDeviceRegisterInfo)===null||i===void 0?void 0:i.regblocks.find((e=>e.name===t));return o.registers.reduce(((t,i)=>{t=t||i.name.toLowerCase().includes(e);if(this.searchBitFields){t=t||this.hasFilteredField(i,e)}return t}),false)}setFilterMethod(){var t;(t=this.grid)===null||t===void 0?void 0:t.setFilterMethod(this.showDetails?this.filterRegisterForDetailsCallback:this.searchBitFields?this.filterRegistersAndFieldsCallback:this.filterRegistersOnlyCallback)}renderFieldDetail(t){var e;return i("tr",null,i("td",null,t.stop,":",t.start),i("td",null,t.name),i("td",{class:"col3",innerHTML:(e=t.desc)===null||e===void 0?void 0:e.split("\n").join("<br>")}))}renderDetails(t){var e,o,r,s;const l=n.convert((e=t.default)!==null&&e!==void 0?e:0,"number","hex",t.nBytes*2);return i("div",{id:"registerDetails",class:"stretch"},i("div",{class:"detail-heading"},t.title||t.name),i("gc-widget-icon",{appearance:"primary",icon:"navigation:cancel",size:"s",class:"clickable",onClick:this.toggleDetails}),i("div",{innerHTML:(r=(o=t.desc)===null||o===void 0?void 0:o.split("\n").join("<br/>"))!==null&&r!==void 0?r:""}),i("div",null,`Default value: ${l}`),i("table",null,i("tr",null,i("th",null,"Bits"),i("th",null,"Name"),i("th",null,"Description")),(s=t.fields)===null||s===void 0?void 0:s.map((t=>this.renderFieldDetail(t)))))}render(){var t,e,o,r,n,s;const l=this.modelIdLabels.indexOf(";")>0;const a=(t=this.activeRegisterModel)===null||t===void 0?void 0:t.getRegisterInfo(this.selectedRegister);const h=(e=a===null||a===void 0?void 0:a.fields)===null||e===void 0?void 0:e[this.selectedFieldIndex];const c=this.busyProgress!==undefined||this.autoReadValue>-1;const d=!this.deferredWriteEnabled||!a||((o=a.attrs)===null||o===void 0?void 0:o.readonly);const g=this.hideDeviceName?undefined:(r=this.activeDeviceRegisterInfo)===null||r===void 0?void 0:r.info.name;const u=this.showDetails?(n=this.activeRegisterModel)===null||n===void 0?void 0:n.getRegisterInfo(this.showDetails):undefined;return i("div",{class:"root-container column"},i("div",{class:"row bottom"},i("div",{class:"stretch"},i("div",{class:"title"},i("span",{class:"heading"},"Register Map"),i("span",{class:"sub-heading"},g))),l?i("gc-widget-select",{id:"modelSelect",key:"models",caption:"Register model",labels:this.modelIdLabels,"onSelected-label-changed":this.onSelectedModelChanged,initialIndex:0}):null,i("slot",null),i("gc-widget-select",{id:"autoReadSelect",key:"autoRead",caption:"Auto read",labels:this.autoReadLabels,values:this.autoReadValues,selectedValue:this.autoReadValue,"onSelected-value-changed":this.onAutoReadSelectedValueChanged}),i("gc-widget-button",{id:"read",label:"Read",disabled:a===undefined||c,onClick:this.doRead}),i("gc-widget-button",{id:"readAll",label:"Read all",disabled:c,onClick:this.doReadAll}),i("gc-widget-button",{id:"write",label:"Write",disabled:d,onClick:this.doWrite}),i("gc-widget-button",{id:"writeAll",label:"Write all",disabled:!this.deferredWriteEnabled,onClick:this.doWriteAll}),i("gc-widget-toggle-switch",{id:"deferredModeSwitch",caption:"Write mode",label:"Immediate",labelWhenChecked:"Deferred","onChecked-changed":this.onWriteDeferredModeChanged,checked:this.deferredWriteEnabled,ref:t=>this.deferredModeToggle=t})),i("gc-widget-container",{class:"stretch"},i("div",{class:"row fill",id:"main"},i("div",{class:"stretch column fill"},i("div",{class:"row center"},i("gc-widget-input-filter",{id:"search",placeholder:"Search registers by name",class:"stretch",hasClearIcon:true,hasSearchIcon:true,selectOnFocus:true,intermediateChanges:true,"onValue-changed":this.onFilterTextChanged}),i("gc-widget-checkbox",{id:"searchBitFieldsCheckbox",label:"Search bitfields","onChecked-changed":this.onSearchBitFieldsCheckedChanged})),i("gc-widget-container",{class:u?"no-shrink":"stretch"},i("gc-widget-register-grid",{id:"registerGrid",ref:t=>this.grid=t,class:"fill","register-model-id":this.activeRegisterModelId,virtual:this.virtual,"selected-field":h===null||h===void 0?void 0:h.id,"onSelected-register-changed":this.onSelectedRegisterChanged,filterText:u?this.showDetails:(s=this.filterText)===null||s===void 0?void 0:s.toLowerCase()})),u?this.renderDetails(u):null),i("gc-widget-register-bitfield-viewer",{id:"bitFieldViewer",heading:"Field View",registerModelId:this.activeRegisterModelId,registerName:this.selectedRegister,"onSelected-field-index-changed":this.onSelectedFieldIndexChanged}))))}connectedCallback(){const t=document.querySelectorAll("gc-model-register");const e=[];if(t){t.forEach((t=>e.push(t.id)))}this.modelIdLabels=e.join(";");this.setActiveModel(e[0])}disconnectedCallback(){this.setActiveModel()}componentDidLoad(){this.setFilterMethod()}onInfoIconClicked(){this.toggleDetails()}expandToLevel(t){if(!this.grid){throw new Error("Register view not rendered yet.  You cannot expand levels until the register view has rendered at least once.")}return this.grid.expandToLevel(t)}async setCSSProperty(t,e){e=e.trim();if(await this.getCSSProperty(t)!==e){this.el.style.setProperty(t,e);this.cssPropertyChanged.emit({name:t,value:e})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return o(this)}};D.style=R;export{v as gc_widget_register_bitfield_viewer,w as gc_widget_register_bits_column,S as gc_widget_register_grid,D as gc_widget_register_view};
//# sourceMappingURL=p-1cb2d28e.entry.js.map