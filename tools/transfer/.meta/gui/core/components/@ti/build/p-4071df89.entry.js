import{r as t,c as i,h as e,g as o}from"./p-ce1dc307.js";import{GcConsole as s}from"../gc-core-assets/lib/GcConsole";import{UndoStack as n}from"../gc-core-assets/lib/UndoStack";import{ServicesRegistry as r}from"../gc-core-services/lib/ServicesRegistry";import{targetConfigServiceType as c}from"../gc-service-target-config/lib/TargetConfigService";import{W as a}from"./p-6a8f5ea3.js";import{GcPromise as l}from"../gc-core-assets/lib/GcPromise";import{SystemSetupEditor as h}from"../gc-target-ccxml-parser/lib/TargetCcxmlParser";import{GcUtils as d}from"../gc-core-assets/lib/GcUtils";import"../gc-core-assets/lib/GcFiles";import"../gc-core-assets/lib/GcLocalStorage";import"../gc-widget-message-dialog/lib/GcMessageDialog";class g{constructor(t,i,e,o=""){this.editor=t;this.value=i;this.description=o;if(!this.description){if(i){this.description=`set ${e}=${this.value.toString()}`}else{this.description=`clear ${e}`}}}undo(){this.value=this.swap(this.value)}redo(){this.value=this.swap(this.value)}toString(){return this.description}}class u{constructor(t,i=""){var e,o;this.systemSetupEditor=t;this.id=i;this._cpuList=new Array;this._cpuList=(o=(e=this.systemSetupEditor)===null||e===void 0?void 0:e.getCpusList().map((t=>({element:t,name:t.getTextToDisplay()}))))!==null&&o!==void 0?o:[];this.selectedCpuIndex=this._cpuList.length>0?0:-1}static createNew(t){const i=l.create((async(e,o)=>{try{let{ccxmlText:o,connectionName:s,deviceName:n,fileName:a}=t;if(!o){const t=r.getService(c);o=await t.getConfig(s,n)}const l=new h;a=a||"./default.ccxml";await l.load(o,a,(()=>i.cancelled));if(i.cancelled){throw new Error("operation cancelled")}const d=l.getErrorMessage(null);if(d){throw new Error(d)}if(!s||!n){const t=l.getComponentList("connection")[0];s=l.getComponentName(t);const i=l.getComponentList("device",t)[0];n=l.getComponentName(i)}await l.ensureBuiltInProperties("cpu");e(new u(l,`${s}/${n}`))}catch(t){o(t)}}));return i}get cpuList(){return this._cpuList.map((t=>t.name))}get selectedCpu(){return this._cpuList[this.selectedCpuIndex].name}set selectedCpu(t){this.selectedCpuIndex=this._cpuList.findIndex((i=>i.name===t))}get selectedPropertiesCaption(){let t=this.selectedPath&&this.systemSetupEditor.findElementTypeByPath(this.selectedPath);if(t){t=t.charAt(0).toUpperCase()+t.slice(1)}return t}setSelection(t,i){if(t===0){this.selectedCpu=i}else{this.selectedPath=i}}get properties(){var t,i;if(this.selectedCpuIndex<0||this.selectedCpuIndex>=this._cpuList.length){return[]}return(i=(t=this.systemSetupEditor)===null||t===void 0?void 0:t.getProperties(this._cpuList[this.selectedCpuIndex].element,true))!==null&&i!==void 0?i:[]}getValues(t,i){return t.reduce(((t,e)=>{var o;const s=(o=e.id)!==null&&o!==void 0?o:e.caption;if(s&&this.systemSetupEditor){t[s]=this.systemSetupEditor.getProperty(e,e.widgetType==="select"?true:false,i)}return t}),{})}setValue(t,i,e){var o;const s=(t===0?this.properties:this.advancedProperties).find((t=>{var e;return((e=t.id)!==null&&e!==void 0?e:t.caption)===i}));if(!s){throw new Error(`No such property with id ${i}`)}(o=this.systemSetupEditor)===null||o===void 0?void 0:o.setProperty(s,e,s.widgetType==="select"?true:false)}async ensureBuiltInProperties(){const t=this.selectedPath&&this.systemSetupEditor.findElementTypeByPath(this.selectedPath);if(t){return this.systemSetupEditor.ensureBuiltInProperties(t)}}get advancedProperties(){var t;const i=this.selectedPath&&this.systemSetupEditor.findElementByPath(this.selectedPath);if(!i){return[]}return(t=this.systemSetupEditor)===null||t===void 0?void 0:t.getProperties(i)}get root(){var t,i;return(i=(t=this.systemSetupEditor)===null||t===void 0?void 0:t.getRoot())!==null&&i!==void 0?i:undefined}get ccxmlText(){var t,i;return(i=(t=this.systemSetupEditor)===null||t===void 0?void 0:t.getXmlText())!==null&&i!==void 0?i:""}}u.setPropertyOperation=class{constructor(t,i,e,o,s,n){this.editor=t;this.page=i;this.selection=e;this.name=o;this.newValue=s;this.oldValue=n}undo(){this.editor.setProperty(this.page,this.selection,this.name,this.oldValue)}redo(){this.editor.setProperty(this.page,this.selection,this.name,this.newValue)}toString(){return`set ${this.name}=${this.newValue}`}};u.SetConnectionOperation=class extends g{constructor(t,i){super(t,i,"connection")}swap(t){const i=this.editor.getSelection();this.editor.setSelection({...i,connectionName:t});return i.connectionName}};u.SetDeviceOperation=class extends g{constructor(t,i){super(t,i,"device")}swap(t){const i=this.editor.getSelection();this.editor.setSelection({...i,deviceName:t});return i.deviceName}};u.SetSessionOperation=class extends g{constructor(t,i,e,o){super(t,{ccxml:i,selection:e},"","replace all ccxml text");this.id=o}swap(t){const i=this.editor.swapConfiguration(this.id,t.ccxml);const e=this.editor.getSelection();this.editor.setSelection(t.selection);return{ccxml:i,selection:e}}};u.nullSession=new u;class v{constructor(t,i=(t=>{})){this.onSelectedDeviceChanged=i;t=t.filter((t=>!t.id.includes("(Bootloader)")));this.devices=t;this.rowCount=t.length}getValue(t,i){const e=this.devices[t].id;if(i==="selected"){return e===this.selectedDevice}return e}setValue(t,i,e){if(i==="selected"){const i=e?this.devices[t].id:undefined;this.onSelectedDeviceChanged(i)}}getDeviceByName(t){return this.devices.find((i=>i.id===t))}getDeviceByRow(t){return this.devices[t]}lookupRowByName(t){return this.devices.findIndex((i=>i.id===t))}static isDeviceFiltered(t,i){return t.toLowerCase().includes(i.toLowerCase())}static filterByFunction(t,i,e){const o=e.indexOf(";");const s=o>0?+e.substring(0,o):-1;e=e.substring(o+1);const n=i.getDeviceByRow(t);return(s<0||n.connectionIndices.includes(s))&&(!e||v.isDeviceFiltered(n.id,e))}readDeviceDescription(t){const i=l.create((async(i,e)=>{var o;try{const e=this.getDeviceByName(t);if(!e){throw new Error(`Cannot read device description: device ${t} does not exist.`)}const s=r.getService(c);const n=await s.getFile(`ccs_base/common/targetdb/devices/${e.xmlFile}.xml`);let a;const l=s.parseConfig(n);for(let t=(o=l.getRootNode())===null||o===void 0?void 0:o.firstChild;t;t=t.nextSibling){if(t.nodeName==="device"){a=t.getAttribute("description")}}if(!a){a=`${t} (description not available)`}i(a)}catch(t){e(t)}}));return i}}const m=':host::-webkit-scrollbar,::-webkit-scrollbar{width:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px));height:var(--gc-scrollbar-width, var(--theme-scrollbar-width, 8px))}:host::-webkit-scrollbar-track,::-webkit-scrollbar-track{background:var(--gc-scrollbar-track-background-color, var(--theme-scroll-track-color, rgba(35, 31, 32, 0.2)))}:host::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb{background:var(--gc-scrollbar-thumb-background-color, var(--theme-scroll-thumb-color, rgba(35, 31, 32, 0.65)))}:host::-webkit-scrollbar-thumb:hover,::-webkit-scrollbar-thumb:hover{background:var(--gc-scrollbar-thumb-background-color-hover, var(--theme-scroll-thumb-color-hover, rgba(35, 31, 32, 0.8)))}:host::-webkit-scrollbar-corner,::-webkit-scrollbar-corner{background:rgba(0, 0, 0, 0)}:host(:focus),:host *:focus{outline:none}:host{-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;font-family:var(--gc-font-family, var(--theme-font-family, "Roboto", "Open Sans", "Segoe UI", "Tahoma", "sans-serif"));font-size:var(--gc-font-size, var(--theme-font-size, 14px));font-weight:400;color:var(--gc-font-color, var(--gc-font-color, var(--theme-font-color, #555555)));margin:var(--gc-margin, var(--theme-margin, 5px));display:inline-block;box-sizing:border-box}:host .user-select{-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;-o-user-select:text;user-select:text}:host .text-link{color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-color:var(--gc-link-color, var(--gc-link-color, var(--theme-link-color, #333333)));--gc-text-decoration-hover:underline;--gc-cursor-hover:pointer}:host .text-link:not([disabled]):hover{text-decoration:underline;cursor:pointer}:host([hidden]){display:none !important}:host([readonly]) *{pointer-events:none}:host([disabled]) *{cursor:not-allowed}:host([caption]:not([caption=""])){margin-top:calc(var(--gc-margin, var(--theme-margin, 5px)) + var(--gc-caption-font-size, var(--theme-caption-font-size, 14px)) + 8px)}:host([caption]:not([caption=""])),:host([info-text]:not([info-text=""])){overflow:visible;position:relative}:host([caption=""][info-text]:not([info-text=""])),:host([info-text]:not([info-text=""]):not([caption])){margin-right:calc(var(--gc-margin, var(--theme-margin, 5px)) + 22px)}#elementWrapper{box-sizing:content-box;height:100%;width:100%;display:flex;align-items:center;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container{position:relative;display:flex;flex-direction:column;width:100%;height:100%;min-height:inherit;max-height:inherit;min-width:inherit;max-width:inherit}.root-container .header-container.top{top:var(--gc-header-container-top, calc(0px - 8px - var(--gc-caption-font-size, var(--theme-caption-font-size, 14px))));flex-direction:row}.root-container .header-container.side{right:-22px;flex-direction:column;height:inherit}.root-container .header-container{position:absolute;display:flex;align-items:center}.root-container .header-container .icon,.root-container .header-container gc-widget-icon{cursor:default;margin:auto;height:18px;width:18px;display:block;--gc-color:var(--gc-caption-info-color, var(--theme-caption-info-color, #98999b))}.root-container .header-container .caption{flex:1;cursor:default;white-space:nowrap;margin-right:2px;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}.invisible{visibility:hidden}:host{width:600px;height:800px;margin:0}#elementWrapper{align-items:stretch}#ccxml_tabs{flex:1;height:auto}#ccxml_tabs .column{display:inline-flex;flex-direction:column;align-items:stretch}#ccxml_tabs .column gc-widget-select,#ccxml_tabs .column gc-widget-input-filter{width:auto}#ccxml_tabs .column gc-widget-property-grid{--gc-caption-text-align:left}#ccxml_tabs .column #cpus{align-self:start}#ccxml_tabs .column .caption{white-space:nowrap;font-weight:var(--gc-caption-font-weight, var(--theme-caption-font-weight, 400));font-size:var(--gc-caption-font-size, var(--theme-caption-font-size, 14px));color:var(--gc-caption-font-color, var(--theme-caption-font-color, #999999))}#ccxml_tabs .column .caption.none{visibility:hidden}#ccxml_tabs .column #notes{border:1px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5));margin:var(--gc-margin, var(--theme-margin, 5px));padding:var(--gc-margin, var(--theme-margin, 5px));white-space:wrap;min-height:80px;user-select:text}#ccxml_tabs .row{display:flex;height:100%}#ccxml_tabs .row.stretch{overflow-x:auto}#ccxml_tabs .stretch{flex:1}#ccxml_tabs div.fill{flex:1;position:relative}#ccxml_tabs div.fill>:first-child{position:absolute;left:0;top:0;right:0;bottom:0}#ccxml_tabs gc-widget-grid-data-column{--gc-heading-text-align:start}#ccxml_tabs gc-widget-grid-data-column#deviceColumn{--gc-column-width:minmax(220px, 1fr)}#ccxml_tabs gc-widget-grid-data-column.center{--gc-text-align:center}#ccxml_tabs gc-widget-grid-tree-column{--gc-column-width:1fr}#ccxml_tabs #properties{border:2px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5));overflow:auto;margin:var(--gc-margin, var(--theme-margin, 5px))}#ccxml_tabs #properties gc-widget-property-grid{--gc-caption-text-align:top}#ccxml_tabs .button{width:150px}div#debuggables{margin:var(--gc-margin, var(--theme-margin, 5px));margin-bottom:0px}div#debuggables div.progress{border:2px solid var(--theme-secondary-color, #118899);border-bottom:2px solid var(--gc-border-color, var(--theme-border-color, #e5e5e5));border-radius:50%;width:10px;height:10px;animation:spin 0.8s linear infinite;display:inline-block;fill:var(--gc-icon-color, var(--theme-secondary-color, #118899));margin:0 2px 0 2px;vertical-align:middle}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}';let p=class{constructor(e){t(this,e);this.selectedTabIndexChanged=i(this,"selected-tab-index-changed",7);this.undoDescriptionChanged=i(this,"undo-description-changed",7);this.redoDescriptionChanged=i(this,"redo-description-changed",7);this.dirtyStateChanged=i(this,"dirty-state-changed",7);this.cssPropertyChanged=i(this,"css-property-changed",7);this.connections=[];this.devices=new v([]);this.initialized=false;this.undoStack=new n;this.configurations=new Map;this.deviceDescriptions=new Map;this.activeConfiguration=u.nullSession;this.filteredConnections=[];this.selectedConnectionByIndex=-1;this.filterDevicesText="";this.deviceDescription="";this.waitingForAdvancedProperties=false;this.tabsPosition="bottom";this.undoDescription="";this.redoDescription="";this.dirtyState=false;this.stopPropagation=t=>{t.stopPropagation()};this.onIndexChanged=t=>{this.selectedTabIndex=t.detail.value;this.selectedTabIndexChanged.emit({value:t.detail.value})};this.onDeviceFilterValueChanged=t=>{var i,e;this.filterDevicesText=(e=(i=t.detail)===null||i===void 0?void 0:i.value)!==null&&e!==void 0?e:""};this.onSelectedConnectionChanged=t=>{const i=t.detail.value;if(this.selectedConnection!==t.detail.value){this.pushOperation(new u.SetConnectionOperation(this,i))}};this.onSelectedDeviceChanged=t=>{var i;if(((i=this.devices)===null||i===void 0?void 0:i.selectedDevice)!==t){this.pushOperation(new u.SetDeviceOperation(this,t))}};this.onDeviceDescriptionChanged=async()=>{var t,i,e;this.deviceDescription="";const o=(t=this.deviceGrid)===null||t===void 0?void 0:t.selectedPath;this.highlightedDevice=o;if(!o||!this.devices){return}if((i=this.deviceDescriptionPromise)===null||i===void 0?void 0:i.isPending){try{await this.deviceDescriptionPromise}catch(t){}this.deviceDescriptionPromise=undefined;if(((e=this.deviceGrid)===null||e===void 0?void 0:e.selectedPath)!==o){return}}let s=this.deviceDescriptions.get(o);if(!s){s=this.devices.readDeviceDescription(o);this.deviceDescriptions.set(o,s)}this.deviceDescriptionPromise=s;try{this.deviceDescription=await s}catch(t){this.logger.error(`Problem reading device description: ${t.message||t.toString()}`);this.deviceDescription=`${o} (description not available)`}};this.onAdvanceTreeSelectionChanged=()=>{var t;if(this.activeConfiguration){this.activeConfiguration.selectedPath=(t=this.advancedTreeGrid)===null||t===void 0?void 0:t.selectedPath;this.ensureDefaultProperties()}};this.onSelectedCpuIndexChanged=t=>{if(this.activeConfiguration){this.activeConfiguration.selectedCpuIndex=t.detail.value;this.refresh()}};this.onCpuPropertyValueChanged=t=>{this.onPropertyValueChanged(0,t,this.activeConfiguration.selectedCpu)};this.onAdvancedPropertyValueChanged=t=>{this.onPropertyValueChanged(1,t,this.activeConfiguration.selectedPath)};this._refresh=0;this.hidden=false}onActiveConfigurationChanged(){var t;(t=this.advancedTreeGrid)===null||t===void 0?void 0:t.setDataProvider(this.activeConfiguration.root,8,this.activeConfiguration.id)}getConnectionIndexByName(t){var i;return(i=this.connections.findIndex((i=>i.id===t)))!==null&&i!==void 0?i:-1}get selectedConnection(){var t;if(this.selectedConnectionByIndex<0){return p.DEFAULT_CONNECTION}return(t=this.connections[this.selectedConnectionByIndex])===null||t===void 0?void 0:t.id}set selectedConnection(t){this.selectedConnectionByIndex=this.getConnectionIndexByName(t)}get logger(){if(!this._logger){this._logger=new s("gc-widget-ccxml-editor",this.el.id)}return this._logger}onUndoDescriptionChanged(){var t,i;this.undoDescriptionChanged.emit({value:(i=(t=this.undoStack.undoStack[0])===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:undefined})}onRedoDescriptionChanged(){var t,i;this.redoDescriptionChanged.emit({value:(i=(t=this.undoStack.redoStack[0])===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:undefined})}onDirtyStateChanged(){if(this.dirtyState!==this.undoStack.dirty){this.undoStack.dirty=this.dirtyState}this.dirtyStateChanged.emit({value:this.undoStack.dirty})}async load(t,i,e=false){var o;try{const s=u.createNew({ccxmlText:t,fileName:i});const r=await s;const[c,a]=r.id.split("/");if(!c){throw new Error("Failed to load .ccxml file.  The contents is missing a connection.")}const l=this.getConnectionIndexByName(c);if(l<0){throw new Error(`Failed to load .ccxml file.  The connection id="${c}" is not a known connection.`)}if(!a){throw new Error("Failed to load .ccxml file.  The contents is missing a device.")}const h=(o=this.devices)===null||o===void 0?void 0:o.getDeviceByName(a);if(!h){throw new Error(`Failed to load .ccxml file.  The connection id="${c}" is not a known connection.`)}if(!h.connectionIndices.includes(l)){throw new Error(`Failed to load .ccxml file.  The connection id="${c}" is not supported by the device id="${a}`)}const d=new u.SetSessionOperation(this,s,{connectionName:c,deviceName:a},r.id);if(e){this.logger.debug(`(load) ${d.toString()}`);d.redo();this.undoStack=new n;this.onUndoStackChanged()}else{this.pushOperation(d)}}catch(t){this.logger.error(t.message||t.toString());throw t}}async save(){this.dirtyState=false;return this.activeConfiguration.ccxmlText}async undo(){if(this.undoStack.canUndo){const t=this.undoStack.popUndoStack();this.logger.debug(`(undo) ${t.toString()}`);t.undo();this.onUndoStackChanged()}}async paste(t){if(t){await this.load(t)}}async copy(){return this.activeConfiguration.ccxmlText}async redo(){if(this.undoStack.canRedo){const t=this.undoStack.popRedoStack();this.logger.debug(`(redo) ${t.toString()}`);t.redo();this.onUndoStackChanged()}}onUndoStackChanged(){var t,i,e,o;this.undoDescription=(i=(t=this.undoStack.undoStack[0])===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"";this.redoDescription=(o=(e=this.undoStack.redoStack[0])===null||e===void 0?void 0:e.toString())!==null&&o!==void 0?o:"";this.dirtyState=this.undoStack.dirty}pushOperation(t){this.logger.debug(`(push) ${t.toString()}`);this.undoStack.pushOperation(t);t.redo();this.onUndoStackChanged()}async ensureDefaultProperties(){try{this.waitingForAdvancedProperties=true;await this.activeConfiguration.ensureBuiltInProperties()}finally{this.waitingForAdvancedProperties=false}}onPropertyValueChanged(t,i,e){var o;if(this.activeConfiguration&&i.detail.value!=i.detail.oldValue){this.pushOperation(new u.setPropertyOperation(this,t,e,(o=i.detail.id)!==null&&o!==void 0?o:i.detail.caption,i.detail.value,i.detail.oldValue))}}doFilterConnections(t,i){const e=i&&this.devices?this.devices.getDeviceByName(i):undefined;let o;if(e){o=e.connectionIndices.map((i=>t[i].id))}else{o=t.map((t=>t.id))}o=o.filter((t=>t!=="Serial Connection"));o=o.sort();o.unshift(p.DEFAULT_CONNECTION);return o}connectedCallback(){this.initialized=false;this.devices=undefined;const t=r.getService(c);t.getConfigInfo().then((t=>{this.devices=new v(t.devices,this.onSelectedDeviceChanged);this.connections=t.connections;this.filteredConnections=this.doFilterConnections(this.connections)}))}render(){var t,i,o,s,n;const r=(t=this.devices)===null||t===void 0?void 0:t.selectedDevice;let c=this.filteredConnections.join("|");if(c.startsWith(p.DEFAULT_CONNECTION+"|")){const t=`recommended (${this.getRecommendedConnectionOption(r)})`;c=t+c.substring(p.DEFAULT_CONNECTION.length)}const l=this.filterDevicesText||this.selectedConnectionByIndex>=0?`${this.selectedConnectionByIndex};${this.filterDevicesText}`:"";const h=this.activeConfiguration.cpuList;const g=(i=this.activeConfiguration)===null||i===void 0?void 0:i.selectedCpuIndex;const u=this.activeConfiguration.properties;const v=this.fileSeparator||(d.OS==="win"?"\\":"/");const m=this.activeConfiguration.getValues(u,v);const f=this.waitingForAdvancedProperties?[]:this.activeConfiguration.advancedProperties;const b=this.activeConfiguration.getValues(f,v);const w=this.activeConfiguration.selectedPropertiesCaption;return a.doRender(e("gc-widget-tab-container",{id:"ccxml_tabs",position:this.tabsPosition,index:this.selectedTabIndex,initialIndex:0,"onIndex-changed":this.onIndexChanged},e("gc-widget-tab-panel",{id:"basic_page",label:"Basic",iconName:"round:action:home",hasHeading:true,tooltip:"General Setup"},e("div",{class:"row stretch"},e("div",{class:"column stretch"},e("gc-widget-select",{id:"connection",labels:c,values:this.filteredConnections,selectedValue:this.selectedConnection,"onSelected-value-changed":this.onSelectedConnectionChanged,caption:"Connection",maxVisibleItems:15}),e("gc-widget-input-filter",{id:"filter",hasClearIcon:true,hasSearchIcon:true,"onValue-changed":this.onDeviceFilterValueChanged,"onClear-icon-clicked":this.onDeviceFilterValueChanged,intermediateChanges:true,caption:"Board or Device",value:this.filterDevicesText,onKeyDown:this.stopPropagation}),e("div",{class:"fill"},e("gc-widget-grid",{id:"boards",virtual:true,"smooth-scrolling":true,ref:t=>this.deviceGrid=t,filterText:l,selectedPath:this.highlightedDevice,"onSelected-path-changed":this.onDeviceDescriptionChanged},e("gc-widget-grid-data-column",{class:"center",id:"deviceCheckbox",name:"selected",heading:"Enable",format:"boolean",hideMinimizeAction:true}),e("gc-widget-grid-data-column",{id:"deviceColumn",name:"device",readonly:true,heading:"Boards or Devices",hideMinimizeAction:true}))),e("gc-widget-label",{class:"caption",label:"Notes"}),e("div",{id:"notes",innerHTML:(o=this.deviceDescription.split("\n").join("<br/>"))!==null&&o!==void 0?o:""})),e("div",{class:"column stretch"},e("div",{id:"debuggables",class:"caption"},"Debuggable CPUs (",((s=this.busyPromise)===null||s===void 0?void 0:s.isPending)?e("div",{class:"progress"}):h.length,")"),e("gc-widget-select",{id:"cpus",labels:h,selectedIndex:g,maxVisibleItems:10,"onSelected-index-changed":this.onSelectedCpuIndexChanged,onKeyDown:this.stopPropagation}),e("gc-widget-property-grid",{autoCapitalizeCaption:true,caption:"CPU Properties",propertyInfo:u,values:m,"onProperty-value-changed":this.onCpuPropertyValueChanged,onKeyDown:this.stopPropagation})))),e("gc-widget-tab-panel",{id:"advanced_page",label:"Advanced",iconName:"round:action:settings",hasHeading:true,tooltip:"Advanced Setup"},e("div",{class:"row stretch"},e("div",{class:"column stretch"},e("gc-widget-label",{label:"All Connections",class:"caption"}),e("div",{class:"fill"},e("gc-widget-grid",{id:"advanced_tree",hideHeading:true,class:"stretch",ref:t=>this.advancedTreeGrid=t,"onSelected-path-changed":this.onAdvanceTreeSelectionChanged,selectedPath:(n=this.activeConfiguration)===null||n===void 0?void 0:n.selectedPath},e("gc-widget-grid-tree-column",{name:"tree",hideMinimizeAction:true,heading:"All Connections"})))),e("div",{class:"column"},e("gc-widget-label",{label:"Actions",class:"caption invisible"}),e("gc-widget-button",{id:"new",buttonType:"secondary",label:"New Connection ...",class:"button",disabled:true}),e("gc-widget-button",{id:"add",buttonType:"secondary",label:"Add Device ...",class:"button",disabled:true}),e("gc-widget-button",{id:"delete",buttonType:"secondary",label:"Remove",class:"button",disabled:true}),e("gc-widget-button",{id:"up",buttonType:"secondary",label:"Up",class:"button",disabled:true}),e("gc-widget-button",{id:"down",buttonType:"secondary",label:"Down",class:"button",disabled:true}),e("gc-widget-button",{id:"test_connection",buttonType:"secondary",label:"Test Connection",hidden:true,class:"button"})),e("div",{class:"column stretch"},e("gc-widget-label",{id:"advanced_properties_caption",label:`${w} Properties`,class:`caption${w?"":" none"}`}),e("div",{id:"properties",class:"column stretch"},e("gc-widget-property-grid",{id:"propertyGrid",autoCapitalizeCaption:true,propertyInfo:f,values:b,"onProperty-value-changed":this.onAdvancedPropertyValueChanged})))))))}componentDidRender(){var t,i;if(!this.initialized&&this.devices){(t=this.deviceGrid)===null||t===void 0?void 0:t.setDataProvider(this.devices);(i=this.deviceGrid)===null||i===void 0?void 0:i.setFilterMethod(v.filterByFunction);this.initialized=true}}getRecommendedConnectionOption(t){var i,e,o;const s=(o=t&&((e=(i=this.devices)===null||i===void 0?void 0:i.getDeviceByName(t))===null||e===void 0?void 0:e.defaultConnectionIndex))!==null&&o!==void 0?o:-1;if(s>=0){return this.connections[s].id}let n=0;let r="";this.filteredConnections.forEach((i=>{if(n===0&&i!==p.DEFAULT_CONNECTION){r=i;n=1}if(n<2&&i.indexOf("Texas Instruments")>=0){r=i;n+=2}if(n<4&&i.indexOf("XDS110 USB")>=0){r=i;n=+4}if(t&&n<8&&i.indexOf("MSP430 USB1")>=0&&t.indexOf("MSP430")>=0){r=i;n=+8}}));return r}setProperty(t,i,e,o){try{if(this.activeConfiguration){this.selectedTabIndex=t;this.activeConfiguration.setSelection(t,i);this.activeConfiguration.setValue(t,e,o);this.refresh()}}catch(t){this.logger.error(`Problem setting property for ${e}=${o} ${i}\n${t.message||t.toString()}`)}}swapConfiguration(t,i){const e=this.configurations.get(t);this.configurations.set(t,i);return e}getSelection(){var t;return{connectionName:this.selectedConnection,deviceName:(t=this.devices)===null||t===void 0?void 0:t.selectedDevice}}setSelection(t){var i,e;this.selectedConnection=t.connectionName;const o=(i=this.devices)===null||i===void 0?void 0:i.selectedDevice;if(t.deviceName!==o&&this.devices){if(this.devices.selectedDevice!==t.deviceName){this.devices.selectedDevice=t.deviceName;this.highlightedDevice=t.deviceName;(e=this.deviceGrid)===null||e===void 0?void 0:e.refresh();if(t.deviceName&&this.filterDevicesText&&!v.isDeviceFiltered(t.deviceName,this.filterDevicesText)){this.filterDevicesText=""}}this.filteredConnections=this.doFilterConnections(this.connections,t.deviceName)}this.setActiveConfiguration()}async setActiveConfiguration(){var t;const i=(t=this.devices)===null||t===void 0?void 0:t.selectedDevice;let e=this.selectedConnection;if(e===p.DEFAULT_CONNECTION){e=this.getRecommendedConnectionOption(i)}if(this.busyPromise&&!this.busyPromise.isFulfilled){this.logger.debug("cancelling creating a new configuration");this.busyPromise.cancelled=true}this.busyPromise=undefined;this.activeConfiguration=u.nullSession;if(!i||!e){return}const o=`${e}/${i}`;let s=this.configurations.get(o);if(!s||s.cancelled){this.logger.debug(`creating a new configuration for ${o}`);s=u.createNew({connectionName:e,deviceName:i});this.configurations.set(o,s)}this.busyPromise=s;try{const t=await s;this.logger.debug(`setting active configuration for ${o}`);this.activeConfiguration=t}catch(t){if(!s.cancelled){this.logger.error(`Problem creating configuration for ${o}\n${t.message||t.toString()}`)}}}async setCSSProperty(t,i){i=i.trim();if(await this.getCSSProperty(t)!==i){this.el.style.setProperty(t,i);this.cssPropertyChanged.emit({name:t,value:i})}}async getCSSProperty(t){return getComputedStyle(this.el).getPropertyValue(t).trim()}async refresh(){this._refresh++}get el(){return o(this)}static get watchers(){return{activeConfiguration:["onActiveConfigurationChanged"],undoDescription:["onUndoDescriptionChanged"],redoDescription:["onRedoDescriptionChanged"],dirtyState:["onDirtyStateChanged"]}}};p.DEFAULT_CONNECTION="default";p.style=m;export{p as gc_widget_ccxml_editor};
//# sourceMappingURL=p-4071df89.entry.js.map