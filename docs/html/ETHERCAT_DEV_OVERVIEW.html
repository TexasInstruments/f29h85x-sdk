<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>F29H85x-SDK: EtherCAT Software Development Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="F29H85x-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F29H85x-SDK
   &#160;<span id="projectnumber">1.00.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ETHERCAT_DEV_OVERVIEW.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EtherCAT Software Development Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_components_communication_stack_EtherCAT_2_EcatDevOverview"></a> EtherCAT SubordinateDevice Controller software development involves understanding the data flow of a complete system application, familiarizing with the EtherCAT application stack, and knowing how the EtherCAT MainDevice/SubordinateDevice interact. This chapter includes the following:</p><ul>
<li><a class="el" href="ETHERCAT_DEV_OVERVIEW.html#ETHERCAT_APPLICATION_SOFTWARE_STACK">EtherCAT Application Software Stack</a></li>
<li><a class="el" href="ETHERCAT_DEV_OVERVIEW.html#ETHERCAT_SOFTWARE_STATES_AND_APPLICATION_API">EtherCAT Software States and Application APIs</a></li>
<li><a class="el" href="ETHERCAT_DEV_OVERVIEW.html#ETHERCAT_DEVELOPMENT_OVERVIEW">EtherCAT Development Overview</a></li>
</ul>
<h1><a class="anchor" id="ETHERCAT_APPLICATION_SOFTWARE_STACK"></a>
EtherCAT Application Software Stack</h1>
<p>This section details the various EtherCAT SubordinateDevice application stack layers. The figure below displays the layers from MCU to application.</p>
<p> <style>div.image img[src="ecat_ov_stack.jpg"]{width:50%}</style> </p><div class="image">
<img src="ecat_ov_stack.jpg" alt=""/>
<div class="caption">
EtherCAT Application Stack</div></div>
<ul>
<li>Layer 1:<ul>
<li>There are the specific microcontroller drivers</li>
<li>Such drivers include the system control, EtherCAT subsystem, etc</li>
</ul>
</li>
<li>Layer 2:<ul>
<li>EtherCAT device-specific SubordinateDevice hardware abstraction layer (HAL) drivers</li>
<li>These API requirements are defined by the Beckhoff SubordinateDevice Implementation specification</li>
<li>API functions include EtherCAT hardware initialization, reading/writing to EtherCAT registers/memory, etc</li>
</ul>
</li>
<li>Layer 3:<ul>
<li>Application device-specific hardware header files to map HAL driver APIs to Beckhoff SubordinateDevice stack API naming and usage scheme</li>
</ul>
</li>
<li>Layer 4:<ul>
<li>Device-specific application system wrapper APIs</li>
<li>Includes wrapper functions for APIs such as memcpy, memset, etc</li>
<li>For CPU1, these are primarily necessary to handle word to byte conversations</li>
</ul>
</li>
<li>Layer 5:<ul>
<li>The Beckhoff EtherCAT SubordinateDevice stack code developed and provided by Beckhoff</li>
<li>The EtherCAT SubordinateDevice stack code includes the EtherCAT SubordinateDevice state machine</li>
<li>Additionally, the stack code includes the supported EtherCAT protocol code (CAN over EtherCAT, Ethernet over EtherCAT, etc)</li>
<li>These files are generated from the Beckhoff SubordinateDevice Stack Code (SSC) tool</li>
</ul>
</li>
<li>Layer 6:<ul>
<li>The user SubordinateDevice application</li>
<li>Includes the main application loop and application required APIs to handle EtherCAT SubordinateDevice state changes. Refer to <a class="el" href="ETHERCAT_DEV_OVERVIEW.html#ETHERCAT_SOFTWARE_STATES_AND_APPLICATION_API">EtherCAT Software States and Application APIs</a> section for more info on the states.</li>
<li>Additionally, depending on the EtherCAT protocol, includes defines for that protocol. For example, it defines the object dictionary for the CAN over EtherCAT protocol.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="ETHERCAT_SOFTWARE_STATES_AND_APPLICATION_API"></a>
EtherCAT Software States and Application APIs</h1>
<p>The EtherCAT SubordinateDevice has 4 main states: Initialization(Init), PreOperational(PreOP), SafeOperational(SafeOP), and Operational(OP). Any EtherCAT SubordinateDevice application requires a set of function handlers that are called by the Beckhoff SubordinateDevice stack state machine. The main EtherCAT application code goes in APPL_Application() which is called by the main EtherCAT loop or SYNC interrupt. Figure below details the various SubordinateDevice software states and the handlers that are called by the stack during those transitions.</p>
<p> <style>div.image img[src="ecat_ov_states.jpg"]{width:50%}</style> </p><div class="image">
<img src="ecat_ov_states.jpg" alt=""/>
<div class="caption">
EtherCAT Software States</div></div>
<ol type="1">
<li>Init State:<ul>
<li>First state upon EtherCAT initialization</li>
<li>No communicaton on the applications layer</li>
<li>EtherCAT MainDevice has access to the datalink information registers</li>
</ul>
</li>
<li>Transition to PreOP:<ul>
<li>MainDevice requested PreOP state</li>
<li>SyncManager (SM0, SM1) mailbox settings are checked</li>
<li>Mailbox SyncManager enabled</li>
<li>APPL_StartMailBoxHandler() called</li>
</ul>
</li>
<li>PreOP State:<ul>
<li>Mailbox communicaton on the application layer</li>
<li>No process data communication</li>
</ul>
</li>
<li>Transition to SafeOP:<ul>
<li>MainDevice requested SafeOP state</li>
<li>MainDevice configures application parameters using the mailbox (ex: calculate process data size, setup process data mapping, application specific settings)</li>
<li>MainDevice configures DL register (process data syncManagers, FMMUs)</li>
<li>APPL_StartInputHandler() called</li>
</ul>
</li>
<li>SafeOP State:<ul>
<li>Mailbox communication on the application layer</li>
<li>Process data communication for inputs only (outputs kept in "safe" state)</li>
</ul>
</li>
<li>Transition to OP:<ul>
<li>MainDevice requested OP state</li>
<li>MainDevice sends valid Outputs</li>
<li>APPL_StartOutputHandler() called</li>
</ul>
</li>
<li>OP State:<ul>
<li>Process data communication for inputs and outputs</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="ETHERCAT_DEVELOPMENT_OVERVIEW"></a>
EtherCAT Development Overview</h1>
<p>This provides a look at the high level development flow of the steps described in later chapters in this guide. For more specific, step-by-step details, see <a class="el" href="ETHERCAT_GETTING_STARTED.html">Getting Started Using Examples</a> Chapter.</p>
<p> <style>div.image img[src="ecat_ov_dev_flow.jpg"]{width:50%}</style> </p><div class="image">
<img src="ecat_ov_dev_flow.jpg" alt=""/>
<div class="caption">
EtherCAT Development Flow</div></div>
<ol type="1">
<li>Download C2000Ware and familiarize with the EtherCAT collateral provided<ul>
<li>SSC Configuration XML (f29h85x_ssc_config.xml): A file to import into the SSC tool to be able to generate F29H85x CPU1 specific SubordinateDevice stack files. <dl class="section note"><dt>Note</dt><dd>SSC configuration xml file is not required for f29h85x_cpu1_pdi_hal_test_app example.</dd></dl>
</li>
<li>Application files (main example code, EtherCAT HAL drivers, EtherCAT device system files): Files required for the examples as well as interfacing with the SubordinateDevice stack code files</li>
<li>SubordinateDevice CCS Projects: CCS example projects for F29H85x.</li>
</ul>
</li>
<li>Using the SubordinateDevice stack code (SSC) tool<ul>
<li>Beckhoff EtherCAT SubordinateDevice stack code is not provided in C2000Ware, requires generation from the SSC tool</li>
<li>The SSC tool configurations for F29H85x are setup via importing the SSC configuration XML</li>
<li>Upon importing, users can select between generating SubordinateDevice stack code for F29H65x CPU1</li>
</ul>
</li>
<li>Understanding the SSC generated files<ul>
<li>The SSC generates the device configured SubordinateDevice stack code files which get imported as part of the SubordinateDevice CCS example projects</li>
<li>The SSC generates the ESI (EtherCAT SubordinateDevice Information) XML file. This file is provided to the EtherCAT MainDevice to be used to program the EtherCAT SubordinateDevice EEPROM as well as for the MainDevice to understand the capabilities of that particular EtherCAT SubordinateDevice.</li>
</ul>
</li>
<li>Running EtherCAT MainDevice and programming the MCU<ul>
<li>Once the EtherCAT SubordinateDevice example project (which now includes the EtherCAT SubordinateDevice stack files) is imported and built in CCS, this gets loaded and ran on the F29H85x .</li>
<li>After providing the ESI file to the EtherCAT MainDevice, such as Beckhoff TwinCAT, the EtherCAT MainDevice is used to program the EtherCAT SubordinateDevice EEPROM. Once EEPROM is valid, EtherCAT MainDevice can begin the process of requesting the EtherCAT SubordinateDevice to reach operational mode. </li>
</ul>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
