<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<title>F29H85x-SDK: SIPC Notify</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="F29H85x-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F29H85x-SDK
   &#160;<span id="projectnumber">1.02.02.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <span id="MSearchSelectExt">&#160;</span>
              <input type="text" id="MSearchField" name="query" value="" placeholder="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('DRIVERS_SIPC_NOTIFY_PAGE.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">SIPC Notify</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md250">Introduction</a></li>
<li class="level1"><a href="#autotoc_md251">Secure IPC design description</a><ul><li class="level2"><a href="#Mailbox-mechanism-for-sipc">Mailbox mechanism for SIPC</a></li>
<li class="level2"><a href="#autotoc_md252">SIPC initialization</a></li>
<li class="level2"><a href="#autotoc_md253">Message format.</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md254">Example usage.</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_C_1_2anandyk_2C29_2SDK_2source__code_2c29__sdk__docs_2docs__src_2docs_2api__guide_2components_2drivers_2sipc__notify"></a></p>
<dl class="section note"><dt>Note</dt><dd>Secure IPC Notify driver enables IPC communication between C29 cores and HSM M4 core. This driver cannot be used without TIFS-MCU for HS-SE devices (available on secure resources).</dd></dl>
<h1><a class="anchor" id="autotoc_md250"></a>
Introduction</h1>
<ul>
<li>The <b>secure IPC notify(SIPC Notify)</b> driver enables IPC communication between C29 cores and HSM M4 core for <b>HS-SE</b> devices.</li>
<li>SIPC provides a means of secure communication between C29 CPU and HSM M4 for using HSM services. The underlying implementation uses <b>mailbox HW interrupts and HSM MBOX shared memory</b>(refer <a class="el" href="#Mailbox-mechanism-for-sipc">Mailbox mechanism for SIPC</a>) to pass messages from C29 CPU to HSM M4 and vice versa.</li>
<li>The trusted C29 cores which can post a request for services from HSM are termed as <b>secure hosts</b>. A non-secure host cannot communicate with HSM, moreover, the shared memory used in SIPC communication is not accessible to non-secure hosts. The cores that are going to be secure hosts are defined via <b>sysconfig</b> and this will be a static configuration at compile time. At a time there can only be atmost two secure hosts which can talk to HSM via SIPC, thus the name <b>secure IPC</b>.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Sysconfig initialization has to be handled by <b>HSM client</b>. For Secure IPC, Sysconfig is not supported in this release. It will be available with upcoming SDK releases along with <b>HSM client</b> </dd></dl>
<h1><a class="anchor" id="autotoc_md251"></a>
Secure IPC design description</h1>
<ul>
<li>SIPC supports RTOS-based implementation on the C29 side. The concept of <b>CLIENT IDs</b> is borrowed from DRIVERS_IPC_NOTIFY_PAGE, where in the RTOS scenario each task has a callback registered of type <a class="el" href="group__DRV__SIPC__NOTIFY__MODULE.html#gaff91d2f85a004ae8509bff4429426e39">SIPC_FxnCallback</a>. This function will be called when a message is received for a respective CLIENT ID. Refer to IPC_GUIDE to know more about CLIENT IDs.</li>
<li>HSM client is a wrapper on top of SIPC which asks for specific services from <b>TIFS-MCU</b>. User can install TIFS package from <b>MySecureSw</b> portal.</li>
</ul>
<p> <style>div.image img[src="sipc_communication_model.png"]{width:35%}</style> </p><div class="image">
<img src="sipc_communication_model.png" alt=""/>
<div class="caption">
SIPC communication model (Image to be updated)</div></div>
<ul>
<li>The maximum number of client Ids available on C29 is <a class="el" href="sipc__notify__cfg_8h.html#a1c37c2ce40ff99470b4a1b91487f0271">SIPC_CLIENT_ID_MAX</a> = 2. On the HSM M4 side the <a class="el" href="sipc__notify__cfg_8h.html#a1c37c2ce40ff99470b4a1b91487f0271">SIPC_CLIENT_ID_MAX</a> = 2 as it doesn't run RTOS applications.</li>
</ul>
<h2><a class="anchor" id="Mailbox-mechanism-for-sipc"></a>
Mailbox mechanism for SIPC</h2>
<ul>
<li>SIPC uses <b>HSM_MBOX</b> (4KB) memory for secure communication with HSM. It uses <b>MBOX_READ_DONE_ACK</b> interrupt to notify target core to read from the dedicated message queue residing in <b>HSM_MBOX</b> memory.</li>
<li>The swQx is a struct holding pointer to actual queue location in HSM MBOX. There can be atmost 2 secure hosts at a time, so the total number of queues will be 4. If C29 wants to send a message to HSM then C29 writes into C29 -&gt; HSM queue and sends an interrupt to HSM M4, once acknowledged HSM will read the message from the same queue. Similarly, If HSM wants to send a message then HSM will write into HSM --&gt; C29 queues and sends an interrupt to C29.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The entire HSM MBOX memory must be read and write protected for non-secure hosts. setting up this firewall configuration is the responsibility of the HSM server running on M4.</dd></dl>
<h2><a class="anchor" id="autotoc_md252"></a>
SIPC initialization</h2>
<ul>
<li>Following parameters are user-configurable.<ol type="1">
<li><b>Queue Depth.</b> -: Number of elements per queue.</li>
<li><b>Number of secure hosts</b> -: Could be 1 or 2.</li>
</ol>
</li>
</ul>
<p>These parameters will be initialized via sysconfig.</p>
<ul>
<li>sysconfig will also generate code to allocate memory for the queues in HSM MBOX based on Queue depth and number of secure hosts. The pointer to this queue will be passed to <a class="el" href="group__DRV__SIPC__NOTIFY__MODULE.html#ga41b553325afa726d6add36b361d7bdbc">SIPC_init</a> at init time. For the initialization on C29 side, the <a class="el" href="structSIPC__Params.html#a187a5d40b35a335a03619580b9eecb58">SIPC_Params::tx_SipcQueues</a> will point to <b>gQueue_SecureHostToHsm</b> where C29 will write to HSM. Similarly, <a class="el" href="structSIPC__Params.html#acc0e3df1965dc7364dfec784fa90bcdf">SIPC_Params::rx_SipcQueues</a> will point to <b>gQueueHsmToSecureHost</b> from where C29 will read the message sent by HSM M4.</li>
<li>As the size of HSM MBOX is 4KB the max Queue Depth is limited.<ol type="1">
<li>if <b>SIPC_NUM_C29_CORES</b> is 2 then the total number of queues will be 4 and the max queue depth will be 492/ <a class="el" href="sipc__notify__cfg_8h.html#ac2fdfb0ed32bb14a82ca144071714220">SIPC_MSG_SIZE</a> .</li>
<li>if <b>SIPC_NUM_C29_CORES</b> is 1 then the total number of queues will be 1 and the max queue depth will be 984/ <a class="el" href="sipc__notify__cfg_8h.html#ac2fdfb0ed32bb14a82ca144071714220">SIPC_MSG_SIZE</a> .</li>
</ol>
</li>
<li>In order to inherit the HSM services, the application must comply the uses of IPC via shared memory i.e. a memory region should be designated to both the CPUs.</li>
</ul>
<h2><a class="anchor" id="autotoc_md253"></a>
Message format.</h2>
<p>The message size of SIPC can be in the range of 3 to 100 bytes.</p><ul>
<li>The minimum message size is 3 bytes i.e [ <b>Dest ClientId</b> ][ <b>Src ClientId</b> ][<b>data</b>]. Users can change <a class="el" href="sipc__notify__cfg_8h.html#ac2fdfb0ed32bb14a82ca144071714220">SIPC_MSG_SIZE</a> based on a protocol that is implemented on top of SIPC.</li>
<li>Following is an example of a message structure used by <b>HSM client</b> to communicate with HSM via SIPC. The size of a message is <b>13 bytes</b> refer to <b>HSM_CLIENT</b>.</li>
</ul>
<p> <style>div.image img[src="sipc_message_ex.png"]{width:50%}</style> </p><div class="image">
<img src="sipc_message_ex.png" alt=""/>
<div class="caption">
message format used by HSM client</div></div>
<dl class="section note"><dt>Note</dt><dd>It is recommended to use 13 bytes message format as mentioned above for optimal latency.</dd></dl>
<h1><a class="anchor" id="autotoc_md254"></a>
Example usage.</h1>
<ul>
<li>Please refer to example part of TIFS-MCU package to see SIPC demonstration.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The secure IPC demonstration project is a part of <b>TIFS</b> package for <b>HS-SE</b> devices. To use this example user needs to sign an NDA(non disclosure agreement). <b>TIFS</b> package can installed via mysecure software. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
