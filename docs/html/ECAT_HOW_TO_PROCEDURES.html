<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>F29H85x-SDK: EtherCAT How-To Procedures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="F29H85x-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F29H85x-SDK
   &#160;<span id="projectnumber">1.00.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ECAT_HOW_TO_PROCEDURES.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EtherCAT How-To Procedures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_components_communication_stack_EtherCAT_4_HowToProcedures"></a> </p>
<h1><a class="anchor" id="autotoc_md818"></a>
Example External Connections</h1>
<table class="doxtable">
<tr>
<th>Example </th><th>External Connections  </th></tr>
<tr>
<td><a class="el" href="ETHERCAT_GETTING_STARTED.html#CPU1_PDI_HAL_TEST_EXAMPLE">CPU1 PDI HAL Test Example</a> </td><td>Mini USB connection between controlCARD and computer Ethernet cable connected to controlCARD RJ45 Port 0 and to computer  </td></tr>
</table>
<h1><a class="anchor" id="TWINCAT_SETUP"></a>
Setup TwinCAT</h1>
<ol type="1">
<li><b>Optional:</b> Install Microsoft Visual Studio. This isn’t required since TwinCAT will install a Visual Studio shell if no Visual Studio installation is found.<ul>
<li>Download and install <a href="https://visualstudio.microsoft.com/">Microsoft Visual Studio</a></li>
<li>TwinCAT supports integration into Visual Studio 2010/2012/2013/2015/2017</li>
</ul>
</li>
<li>Download and install TwinCAT3 from the <a href="https://www.beckhoff.com/hi-in/">Beckhoff</a><ul>
<li>Follow the left sidebar to Download-&gt;Software-&gt;TwinCAT 3-&gt;TE1xxx | Engineering and select the software product TwinCAT 3.1 eXtended Automation Engineering (XAE)</li>
</ul>
</li>
<li>Once installation is complete, verify that the TwinCAT Runtime is active<ul>
<li>Check that the TwinCAT Config Mode icon is shown in the Windows notification panel. Right click on this icon and select Tools-&gt;TwinCAT Switch Runtime. From the TcSwitchRuntime window, verify that it is active. When active, it will only provide the option to Deactivate. Don’t Deactivate!</li>
<li>If the icon isn’t present, then locate the TwinCAT Runtime executable from the file system. (Default installation location is typically: C:/TwinCAT/TcSwitchRuntime)  <style>div.image img[src="twincat_xae_icon.jpg"]{width:30%}</style> <div class="image">
<img src="twincat_xae_icon.jpg" alt=""/>
<div class="caption">
TwinCAT Config Mode Icon</div></div>
  <style>div.image img[src="tcswitchruntime.jpg"]{width:50%}</style> <div class="image">
<img src="tcswitchruntime.jpg" alt=""/>
<div class="caption">
TcSwitchRuntime Window Activated</div></div>
</li>
</ul>
</li>
<li>Start up Visual Studio with TwinCAT using one of the following methods:<ul>
<li>Recommended: Right click the TwinCAT Config Mode icon from the Windows notification panel and select TwinCAT XAE</li>
<li>Use installed desktop icon: TwinCAT XAE</li>
<li>Use installed Start Menu icon under Beckhoff folder: TwinCAT XAE</li>
</ul>
</li>
<li>Once Visual Studio running, verify that the main toolbar has options TwinCAT and PLC shown. If these aren’t present, then the TwinCAT Switch Runtime isn’t active.</li>
<li>Within Visual Studio, create a new EtherCAT project. Select File -&gt; New -&gt; Project and under templates select TwinCAT Projects then TwinCAT XAE Project (XML format). Fill in a name and click OK.</li>
<li>Now that the project is created, verify that a realtime Ethernet adapter is installed.<ul>
<li>In Visual Studio, select the TwinCAT menu from the main toolbar and select Show Realtime Ethernet Compatible Devices.</li>
<li>In the popup window, under Installed and ready to use devices(realtime capable) category, if no connections are shown, select one from the list of Compatible devices and click Install.</li>
</ul>
</li>
<li>TwinCAT setup is complete.</li>
</ol>
<h1><a class="anchor" id="TWINCAT_SCAN"></a>
Scanning for EtherCAT SubDevices via TwinCAT</h1>
<ol type="1">
<li>Open the TwinCAT project created via <a class="el" href="ECAT_HOW_TO_PROCEDURES.html#TWINCAT_SETUP">Setup TwinCAT</a>.</li>
<li>Verify that the controlCARD is running the HAL example code and that the development computer (running TwinCAT) is connected via an Ethernet cable to the port 0 connection on the controlCARD.<ul>
<li>Port 0 is the top Ethernet port on the side of the controlCARD with two Ethernet connections.</li>
</ul>
</li>
<li>In Visual Studio on the left side solution explorer, expand the Project, then expand I/O</li>
<li>Right click on Devices and select Scan<ul>
<li>A dialog will popup stating that Not all types of devices can be found automatically. Click OK.</li>
</ul>
</li>
<li>Once scanning is complete, a popup window will appear. The following options may appear:<ul>
<li>A popup stating that 1 new I/O devices found where the device is Device 2 (EtherCAT Automation Protocol). This or any other device numbers besides Device 1 is correct, click OK.</li>
<li>A popup stating that no devices have been found or stating that 1 new I/O devices found where the device is Device 1 (EtherCAT Automation Protocol). This means some setup is incorrect. Verify that the example is running on the device (or at least has gone through the GPIO setup and reset of the EtherCAT IP).</li>
</ul>
</li>
<li>After clicking OK, another popup will ask to Scan for boxes. Click Yes.</li>
<li>After clicking YES, another popup will ask to Activate Free Run. Click Yes.</li>
<li>In the solution explorer on the left, under devices you should see Device 2 (EtherCAT). Under that, there will be a Box #. This Box is the controlCARD ESC.  <style>div.image img[src="twincat_devices.jpg"]{width:50%}</style> <div class="image">
<img src="twincat_devices.jpg" alt=""/>
<div class="caption">
TwinCAT Solution Explorer</div></div>
<ul>
<li>The EtherCAT MainDevice communication is now setup with the SubordinateDevice device.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="PROGRAM_EEPROM"></a>
Program ControlCard EEPROM</h1>
<p>Verify first that TwinCAT has discovered the ESC.</p><ol type="1">
<li>In the Visual Studio solution explorer, double click on Box # under Device 2 (EtherCAT).</li>
<li>The TwinCAT project window should be open to the right of the solution explorer and have some tabs such as General, EtherCAT, etc</li>
<li>Select the EtherCAT tab and then click on Advanced Settings</li>
<li>In the new window, expand the ESC Access menu, then expand the E2PROM menu. Click on Smart View</li>
<li>If running a HAL PDI test Example, follow these steps to begin programming the EEPROM. Otherwise, skip to the next step.<ul>
<li>Click on Write E2PROM and select Browse. Browse to c29_sdk\mcu_sdk_f29h85x\examples\communication\Ethercat\eeprom and select f29h85x_cpu1_pdi_test_app.bin if running the CPU1 example. Click OK. <dl class="section note"><dt>Note</dt><dd>These BIN files only program the required first 15 bytes of EEPROM and should only be used with the HAL examples.</dd></dl>
</li>
</ul>
</li>
<li>If running an Echoback example, follow these steps to begin programming the EEPROM.<ul>
<li>Click on Write E2PROM and expand the Texas Instruments Incorporated menu within the Available EEPROM Descriptions window.</li>
<li>Expand TI C29xx SubordinateDevices and select F29H85x CPU1 EtherCAT SubDevice. Click OK.</li>
</ul>
</li>
<li>Visual Studio will indicate that the EEPROM is being programmed. When it completes, if the Smart View doesn’t automatically update with the new contents, you can select Read E2PROM to read back the newly programmed values.</li>
<li>The Product Code for CPU1 is 0x10003201  <style>div.image img[src="twincat_eeprom.png"]{width:50%}</style> <div class="image">
<img src="twincat_eeprom.png" alt=""/>
<div class="caption">
TwinCAT EEPROM Window</div></div>
</li>
</ol>
<h1><a class="anchor" id="TWINCAT_MEM_WINDOW"></a>
Use TwinCAT Memory Window</h1>
<p>Verify first that TwinCAT has discovered the ESC.</p><ol type="1">
<li>In the Visual Studio solution explorer, double click on Box #.</li>
<li>The TwinCAT project window should be open and have some tabs such as General, EtherCAT, etc</li>
<li>Select the EtherCAT tab and then click on Advanced Settings</li>
<li>In the new window, expand the ESC Access menu, then select Memory. This is the connected ESC memory.  <style>div.image img[src="twincat_memory_window.jpg"]{width:50%}</style> <div class="image">
<img src="twincat_memory_window.jpg" alt=""/>
<div class="caption">
TwinCAT Memory Window</div></div>
</li>
<li>Adjust the Start Offset and Length as necessary to view the ESC registers or RAM. Note that these are byte offsets.<ul>
<li>ESC registers are 0x0 to 0xFFF</li>
<li>ESC RAM is 0x1000 to 0x4FFF</li>
</ul>
</li>
<li>You can select Reload once the offsets are changed or if the ESC is changing memory that needs to be reflected here on the MainDevice side.</li>
<li>Additionally, the memory values can be manipulated through this window and can be applied once the Write button is selected. Such changes can be confirmed by viewing the same memory through the CCS memory browser.</li>
</ol>
<h1><a class="anchor" id="SSC_GENERATION"></a>
Generate SubordinateDevice Stack Code</h1>
<p>These are steps to generate SubordinateDevice stack code without an application.</p><ol type="1">
<li>Install the SSC tool V5.13<ul>
<li>Download from <a href="https://www.ethercat.org/login.aspx?ReturnUrl=%2fmemberarea%2fstack_code.aspx">ETG SSC ET9300</a></li>
</ul>
</li>
<li>Open the SSC tool and a New Project dialog box will open. Select Import and locate the f29h85x_ssc_config.xml. Then click Open. SSC configuration xml file is not required for f29h85x_cpu1_pdi_hal_test_app example.</li>
<li>Use the Custom drop-down menu to select the corresponding project.</li>
<li>Click Yes when the pop up window asks about requiring external files to proceed.</li>
<li>Save the SSC project.</li>
<li>Within SSC tool, go to Project -&gt; Create new SubordinateDevice Files<ul>
<li>You can leave both source and ESI directory paths as default</li>
<li>Click Start and then OK. </li>
</ul>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
