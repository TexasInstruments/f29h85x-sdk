<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>F29H85x-SDK: Uart Flash Programmer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="F29H85x-SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F29H85x-SDK
   &#160;<span id="projectnumber">1.00.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('UART_FLASH_PROGRAMMER_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Uart Flash Programmer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md820">Introduction</a></li>
<li class="level1"><a href="#autotoc_md821">Project Build Setup</a></li>
<li class="level1"><a href="#autotoc_md822">Running the Precompiled Program</a></li>
<li class="level1"><a href="#autotoc_md823">Key &amp; Code Provisioning</a></li>
<li class="level1"><a href="#autotoc_md824">Flash Programmer Supported Parameters</a></li>
<li class="level1"><a href="#autotoc_md825">Flash Programmer Operations</a></li>
<li class="level1"><a href="#autotoc_md826">Generating Combined Image with X.509 Certificate</a></li>
<li class="level1"><a href="#autotoc_md827">API usage</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_tools_uart_flash_programmer"></a></p>
<p>Texas Instruments F29x UART Flash Programmer CLI Example Package</p>
<h1><a class="anchor" id="autotoc_md820"></a>
Introduction</h1>
<p>This page provides a brief rundown of the F29x UART Flash Programmer CLI tool that can be ran in host PC and to be interfaced with BootROM/UART flash kernel on the target device. <br  />
 </p><dl class="section attention"><dt>Attention</dt><dd>For more information, please see Application Note on <a href="https://www.ti.com/lit/pdf/spradn0" target="_blank"><b>Serial Flash Programming for F29x Device</b></a>.</dd></dl>
<h1><a class="anchor" id="autotoc_md821"></a>
Project Build Setup</h1>
<p>Two methods are provided to build and compile the project</p>
<ul>
<li>VS Project (Windows only): User should import uart_flash_programmer.sln into Visual Studio and proceed to build the Visual Studio Project.</li>
<li>CMake (Linux &amp; Windows): CMakeLists.txt is provided to build the project using cmake<ul>
<li>Bash script <code>build_cmake.sh</code> is provided to automate the cmake build</li>
<li>Manual instructions on building CMake:<ul>
<li>In the terminal, proceed to create a build folder and cd into folder via<ul>
<li><code>mkdir build &amp;&amp; cd build</code></li>
</ul>
</li>
<li>Generate CMake artifacts via<ul>
<li><code>cmake -S .. -DCMAKE_BUILD_TYPE={Debug/Release}</code></li>
</ul>
</li>
<li>Build the CMake project via<ul>
<li><code>cmake --build .</code></li>
</ul>
</li>
<li>The generated executable would be called <em>uart_flash_programmer</em> under the build folder</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md822"></a>
Running the Precompiled Program</h1>
<p>Two precompiled executable were provided for this example:</p><ul>
<li>uart_flash_programmer.exe (x86_64)<ul>
<li>uart_flash_programmer.exe will always start off with sending the SBL (secondary bootloader, in this case the uart flash kernel) image to BootROM in UART boot mode, which BootROM would proceed to handoff the device control to SBL. Then the user would be prompted with options to communicate and perform operation in the flash kernel.<ul>
<li>Note: BootROM follows a strict state machine sequence of expecting a SBL boot prior to any HSM operations, as such, please use this executable for operations regarding HSM, such as Key and Code provisioning.</li>
<li>For more information on BootROM and its prerequisite setup, please refer to "ROM bootloader" section of the Application Note.</li>
</ul>
</li>
</ul>
</li>
<li>uart_flash_programmer_appIn.exe (x86_64)<ul>
<li>uart_flash_programmer_appIn.exe will bypass sending the flash kernel to BootROM and goes straight to operation options.<ul>
<li>User can either load the kernel directly to the device via CCS or an alternative image load methods.</li>
<li>To achieve this in a build project, undefine the macro "KERNEL" in include/ <a class="el" href="Common_8h.html" title="Commonly shared libraries, macros and global variables.">Common.h</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For linux users, it is advised to run <code>build_cmake.sh</code> in order to generate an executable with ease. The default source code defines the macro "KERNEL" so the program is identical to uart_flash_programmer.exe, undefine the macro if user wants to bypass the kernel analogous to uart_flash_programmer_appIn.exe.</p>
<h1><a class="anchor" id="autotoc_md823"></a>
Key &amp; Code Provisioning</h1>
<p>By default, any out-of-box device comes with HS-FS (High Security - Field Securable) security governor. Where operations like DFU are permitted without HSM (hardware security module) authentication. In order to upgrade the device to HS-KP (High Security - Key Provision, an intermediate step prior to HS-SE) or HS-SE (High Security - Security Enabled), one must flashs the device through processes known as Key &amp; Code Provision.</p>
<p>In Key Provision, user would be able to replace TI-provided keys with its custom keys for future HSM authentications. And with any subsequent programming operations in flash using the new custom key in forms of X.509 certificate, it'll upgrade the device into HS-KP. The uart flash programmer has the support for Key &amp; Code Provisioning as part of the operation options.</p>
<dl class="section note"><dt>Note</dt><dd>For more information regarding HSM, security governors, and the provisioning flows in detail, please request for the restricted security package under the same TI download page as F29H85X-SDK for F29H85x.</dd></dl>
<h1><a class="anchor" id="autotoc_md824"></a>
Flash Programmer Supported Parameters</h1>
<div class="fragment"><div class="line">Syntax:</div>
<div class="line">uart_flash_programmer.exe -d f29h85x -p &lt;COM/tty Port&gt; -k &lt;uart kernel image&gt;.bin </div>
<div class="line">-a &lt;CPU1 application image&gt;.bin -e &lt;F29x alternate entry address&gt;</div>
<div class="line">-r &lt;HSM runtime image&gt;.bin -f &lt;user HSM keys&gt;.bin -t &lt;CPU1 application image&gt;.bin </div>
<div class="line">-g &lt;HSM application image&gt;.bin -c &lt;sec cfg program image&gt;.bin -q -w</div>
</div><!-- fragment --><p>Supply -h or &ndash;help as a parameter will prompt the following message: </p><pre class="fragment">    F29x UART Firmware Programmer
    Supported parameters are:

    -d, --device &lt;device&gt;     - The device family of the target device:
                                (f29h85x)
    -p, --port   &lt;port&gt;       - Serial COM/tty port used for UART communication.
                                (port format: COM&lt;num&gt;, /dev/ttyUSB&lt;num&gt;, /dev/ttyACM&lt;num&gt;)
    -k, --kernel    &lt;file&gt;    - File path for uart flash kernel
    -a, --appcpu1   &lt;file&gt;    - File path for Flash-based C29 CPU1 application image (HS-FS Only)
    -r, --hsmrt     &lt;file&gt;    - File path for RAM-based HSM runtime (HSMRt) image    (Prerequisite for KP &amp; CP)
    -f, --hsmkeys   &lt;file&gt;    - File path for HSM keys image                         (HS-KP key provision)
    -t, --cpappcpu1 &lt;file&gt;    - File path for Flash-based CPU1 application image     (HS-SE code provision)
    -g, --cpapphsm  &lt;file&gt;    - File path for Flash-based HSM application image      (HS-SE code provision)
    -s, --cpseccfg  &lt;file&gt;    - File path for Sec Cfg program image                  (HS-SE code provision)
    -e, --entryaddr &lt;hex_num&gt; - (optional) Override entry address of the C29 CPU1 application

    Note: -d, -p, -k are mandatory parameters.
    Note: Images must be in the binary format and includes an X.509 certificate.

    -h, --help       - Show this help.
    -q, --quiet      - Quiet mode. Suppress all non-essential printouts
    -l, --log &lt;file&gt; - Log mode. Redirect all non-essential printouts to the specified file, will override -q mode
    -w               - Wait on keypress before exiting

    Syntax: -d f29h85x -p COM41 -k ex3_uart_flash_kernel.bin --appcpu1 c29_cpu1_application.bin --entryaddr 10001000 --hsmrt HSM_runtimeImage.bin --hsmkeys HSM_customKeyCert.bin --cpseccfg sec_cfg_cert.bin --cpappcpu1 c29_cpu1_application.bin -cpapphsm hsm_application.bin -l output.log
</pre> <h1><a class="anchor" id="autotoc_md825"></a>
Flash Programmer Operations</h1>
<p>After running uart_flash_programmer.exe, the host will immediately start sending the flash kernel image to the device and proceeds to boot the flash kernel in CPU1. Once successfully programmed to RAM, user will be prompted with the following options:</p>
<ol type="1">
<li>DFU CPU1<ul>
<li>Only valid if device is in HS-FS state</li>
<li>If selected, host will send the C29 CPU1 Flash-based application image to the device</li>
<li>Mandatory parameter: -a (&ndash;appcpu1)</li>
<li>Note: any unused flash sections on the application image should be filled with 0xFF (logic 0), otherwise the image will be filled with 0s and subsequently programmed to flash<ul>
<li>linker example: <code>FLASH_RP0 : o=0x10000030, l=0x100000, FILL(0xFF)</code></li>
</ul>
</li>
</ul>
</li>
<li>Load HSMRt Image<ul>
<li>This step is the prerequisite for the rest of Key Provision &amp; Code Provision flow</li>
<li>If selected, host will send a RAM-based HSMRt image to the device and subsequently boot up the runtime (SBL) image in HSM.</li>
<li>Mandatory parameter: -r (&ndash;hsmrt)</li>
</ul>
</li>
<li>Load HSM Key<ul>
<li>This step is to transition the device into HS-KP by supplying a user HSM key</li>
<li>If selected, host will send the custom keys to the device's HSM and transition into HS-KP upon success.</li>
<li>Mandatory parameter: -f (&ndash;hsmkeys)</li>
</ul>
</li>
<li>Program Sec Cfg<ul>
<li>Device must be in HS-KP or HS-SE</li>
<li>If selected, host will send the image to program Sec Cfg sections. If the device is in HS-KP, it'll be transitioned into HS-SE upon success.</li>
<li>Mandatory parameter: -s (&ndash;cpseccfg)</li>
</ul>
</li>
<li>Load HSM Image<ul>
<li>Device must be in HS-KP or HS-SE</li>
<li>If selected, host will send the Flash-based HSM application image. If the device is in HS-KP, it'll be transitioned into HS-SE upon success.</li>
<li>Mandatory parameter: -g (&ndash;cpapphsm)</li>
</ul>
</li>
<li>Load C29 CPU1 Image<ul>
<li>Device must be in HS-KP or HS-SE</li>
<li>If selected, host will send the Flash-based CPU1 application image. If the device is in HS-KP, it'll be transitioned into HS-SE upon success.</li>
<li>Mandatory parameter: -t (&ndash;cpappcpu1)</li>
</ul>
</li>
<li>Run CPU1<ul>
<li>If selected, CPU1 will either branch to the default entry address or to an alternate entry address if -e (&ndash;entryaddr) is provided.</li>
<li>Optional parameter: -e &ndash;entryaddr</li>
</ul>
</li>
<li>Reset CPU1<ul>
<li>If selected, CPU1 will invoke watchdog timer and reset the CPU.</li>
</ul>
</li>
<li>Done<ul>
<li>Exits the program</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md826"></a>
Generating Combined Image with X.509 Certificate</h1>
<p>All images (application, kernel) must be in binary format and be combined with a X.509 certificate in order to be validated by HSM and subsequently load into the device. If the certificate on the image is invalid, the image download will be halted. On the host programmer, this would result in an abrupt stop shortly after 4096 Bytes of reception.</p>
<p>To generate the combined image with X.509 certificate, please refer to the post-build steps in the flash kernel example (located in examples/driverlib/single_core/flash/uart_flash_kernel)</p><ul>
<li>In CCS-theia/CCS 12.20+, Post-build steps can be found under (Project) Properties-&gt;Build-&gt;Steps</li>
</ul>
<p>Please note that the default post-build step uses TI-provided keys which is only applicable to authenticate HS-FS device, for devices in or transition to HS-KP and HS-SE, please supply a custom key that will be used by HSM for authentication moving forward.</p>
<h1><a class="anchor" id="autotoc_md827"></a>
API usage</h1>
<p><a class="el" href="group__uart__flash__programmer__api.html">APIs for Uart Flash Programmer</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
